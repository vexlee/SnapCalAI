import{c as q,j as e,B as P,A as oe,g as re,s as de,U as se,a as ce,b as xe,d as me,S as he,e as ue,f as ge}from"./index-Cs9c4FFy.js";import{r}from"./vendor-react-wGySg1uH.js";import{C as pe}from"./Card-DjxVovBb.js";import{S as fe,v as be,g as ye,s as we,A,P as je,f as ke,U as ve,a as Ne,M as Se,b as Ce,p as ze}from"./MealDetailModal-CQOv7Zvr.js";import{X as ee}from"./x-B7DFZvYm.js";import{T as L,G as Ae}from"./index-cQ6qJtkF.js";import{C as Ee}from"./camera-CByKHVqQ.js";import{C as Me}from"./chevron-down-BUMFdEqG.js";import{F as Le,P as Te}from"./plus-CjDiQEu5.js";import{T as Ie}from"./target-BLJLFmpk.js";import"./vendor-charts-Bdt_fL2G.js";import"./vendor-supabase-DfwcnzK-.js";import"./chevron-left-CnFS3Ey0.js";import"./users-CwA1y5wA.js";import"./calendar-Dr8sklDz.js";import"./trash-2-CnwVye9B.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=q("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=q("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=q("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=q("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Re=({currentGoal:l,onClose:x,onSave:o})=>{const[a,m]=r.useState(l.toString()),c=()=>{const h=parseInt(a,10);!isNaN(h)&&h>0&&o(h)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-md p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-xs rounded-[32px] p-6 shadow-2xl border border-white/50 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-extrabold text-gray-900",children:"Daily Calorie Goal"}),e.jsx("button",{onClick:x,className:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(ee,{size:18,className:"text-gray-600"})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1",children:"Target Calories"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:a,onChange:h=>m(h.target.value),className:"w-full p-5 bg-gray-50 border border-gray-100 rounded-[20px] focus:outline-none focus:ring-2 focus:ring-royal-200 focus:border-royal-400 transition-all font-extrabold text-3xl text-center text-gray-900",autoFocus:!0}),e.jsx("span",{className:"absolute right-6 top-1/2 -translate-y-1/2 text-gray-400 text-sm font-bold",children:"kcal"})]})]}),e.jsx(P,{className:"w-full py-4 shadow-lg shadow-royal-200",onClick:c,children:"Update Goal"})]})})},Ge=()=>"AIzaSyBe0v3rn4bATheRJCE77AmY58Op-tiJJVU",$e=()=>{const l=Ge();return new Ae({apiKey:l})},Ue=`You are a professional nutritionist and vision AI. Identify all food items in this shared meal image.

For each dish on the table, provide:
1. The dish name (be specific, e.g., "Grilled Chicken Breast" not just "Chicken")
2. A bounding box in [ymin, xmin, ymax, xmax] format with normalized coordinates (0-1000 scale)
3. Total calorie estimate for the ENTIRE portion visible on the table
4. Confidence score (0-1) based on how clearly you can identify the dish

IMPORTANT:
- Detect ALL distinct food items/dishes in the image
- Each dish should have its own bounding box
- Bounding boxes should tightly encompass each dish
- Calorie estimates are for the FULL portion shown, not per serving
- If the image contains no food, return an empty dishes array

Return ONLY a valid JSON object with this exact format:
{
  "dishes": [
    {
      "dish_name": "Dish name here",
      "bounding_box": [ymin, xmin, ymax, xmax],
      "estimated_total_calories": number,
      "confidence_score": 0.95
    }
  ]
}`,Be=l=>{const x=(l==null?void 0:l.message)||String(l)||"",o=x.toLowerCase();return x.includes("429")||o.includes("quota")||o.includes("limit")||o.includes("exhausted")?"AI Limit Reached: You've sent too many requests. Please wait about 60 seconds for the quota to reset.":o.includes("api key")?"Configuration Error: Invalid API key. Please check your settings.":o.includes("network")||o.includes("fetch")?"Connection Error: Please check your internet connection and try again.":x||"An unexpected AI error occurred."};async function le(l,x=2,o=2e3){try{return await l()}catch(a){const m=(a==null?void 0:a.message)||"";if((m.includes("429")||m.toLowerCase().includes("quota"))&&x>0)return console.warn(`Gemini Quota hit. Retrying in ${o}ms... (${x} retries left)`),await new Promise(h=>setTimeout(h,o)),le(l,x-1,o*2);throw a}}const ae=async l=>{try{return await le(async()=>{const o=await $e().models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:l}},{text:"Analyze this shared meal image and identify all dishes with their locations and calorie estimates."}]},config:{systemInstruction:Ue,responseMimeType:"application/json",responseSchema:{type:L.OBJECT,properties:{dishes:{type:L.ARRAY,items:{type:L.OBJECT,properties:{dish_name:{type:L.STRING},bounding_box:{type:L.ARRAY,items:{type:L.INTEGER}},estimated_total_calories:{type:L.INTEGER},confidence_score:{type:L.NUMBER}},required:["dish_name","bounding_box","estimated_total_calories","confidence_score"]}}},required:["dishes"]},temperature:.4,topP:.95}}),a=JSON.parse(o.text||"{}");if(!a.dishes||!Array.isArray(a.dishes))throw new Error("Invalid response format from AI");if(a.dishes.forEach((m,c)=>{if(!Array.isArray(m.bounding_box)||m.bounding_box.length!==4)throw new Error(`Invalid bounding box format for dish ${c+1}`);m.bounding_box=m.bounding_box.map(h=>Math.max(0,Math.min(1e3,h)))}),a.dishes.length===0)throw new Error("No dishes detected in this image. Please ensure the photo clearly shows food items on a table.");return a})}catch(x){throw console.error("Gemini Shared Meal Analysis Error:",x),new Error(Be(x))}},We=(l,x=600,o=150)=>new Promise((a,m)=>{const c=new FileReader;c.readAsDataURL(l),c.onload=h=>{var E;const u=new Image;u.src=(E=h.target)==null?void 0:E.result,u.onload=()=>{const n=document.createElement("canvas");let g=u.width,p=u.height;g>x&&(p=x/g*p,g=x),n.width=g,n.height=p;const j=n.getContext("2d");j==null||j.drawImage(u,0,0,g,p);let f=.5,v=n.toDataURL("image/jpeg",f);const T=o*1024;v.split(",")[1].length*3/4>T&&(f=.35,v=n.toDataURL("image/jpeg",f),v.split(",")[1].length*3/4>T&&(f=.25,v=n.toDataURL("image/jpeg",f))),a(v)},u.onerror=n=>m(n)},c.onerror=h=>m(h)}),Oe=({onClose:l,onSuccess:x,initialImage:o})=>{const[a,m]=r.useState(o?"analyzing":"upload"),[c,h]=r.useState(o||null),[u,E]=r.useState([]),[n,g]=r.useState(new Map),[p,j]=r.useState(null),[f,v]=r.useState(50),[T,C]=r.useState(null),[F,k]=r.useState(!1),D=r.useRef(null),S=r.useRef(null),[te,I]=r.useState({width:0,height:0}),H=async t=>{if(t.target.files&&t.target.files[0]){const i=t.target.files[0];try{const d=await We(i,600,150);h(d),C(null)}catch{C("Failed to process image.")}}};r.useEffect(()=>{o&&a==="analyzing"&&(async()=>{try{const i=o.split(",")[1],d=await ae(i);E(d.dishes),m("selection")}catch(i){C(i.message),m("upload")}})()},[o]);const J=async()=>{if(c){m("analyzing"),C(null);try{const t=c.split(",")[1],i=await ae(t);E(i.dishes),m("selection")}catch(t){C(t.message),m("upload")}}};r.useEffect(()=>{if(S.current&&a==="selection"){const t=()=>{S.current&&I({width:S.current.offsetWidth,height:S.current.offsetHeight})};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)}},[a]);const K=t=>{if(!S.current)return{x:0,y:0};const i=S.current,d=i.offsetWidth,w=i.offsetHeight,$=i.naturalWidth,_=i.naturalHeight,N=(t[1]+t[3])/2,U=(t[0]+t[2])/2,B=N/1e3,Z=U/1e3,W=$/_,V=d/w;let s=d,b=w,y=0,O=0;return W>V?(b=d/W,O=(w-b)/2):(s=w*W,y=(d-s)/2),{x:B*s+y,y:Z*b+O}},Y=t=>{j(t),v(n.get(t)||50)},R=()=>{if(p!==null){const t=new Map(n);f>0?t.set(p,f):t.delete(p),g(t),j(null)}},X=()=>{let t=0;return n.forEach((i,d)=>{const w=u[d];t+=Math.round(w.estimated_total_calories*i/100)}),t},G=async()=>{if(n.size===0){C("Please select at least one dish portion.");return}k(!0),C(null);try{const t=new Date,i=t.toISOString(),d=re(),w=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;for(const[$,_]of Array.from(n.entries())){const N=u[$],U=Math.round(N.estimated_total_calories*_/100),B={id:be(),timestamp:i,date:d,time:w,food_item:`${N.dish_name} (Shared Meal - ${_}%)`,calories:U,protein:0,carbs:0,fat:0,confidence:N.confidence_score,imageUrl:c||void 0,isManual:!1};await de(B)}x()}catch(t){console.error("Save failed:",t),C(t.message||"Failed to save entries.")}finally{k(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-md p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-[#1a1c26] w-full max-w-md rounded-[40px] p-6 shadow-2xl border border-white/50 dark:border-white/5 animate-in slide-in-from-bottom duration-300 max-h-[95vh] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 dark:text-gray-50 tracking-tight",children:a==="upload"?"Shared Meal":a==="analyzing"?"Analyzing...":a==="selection"?"Select Portions":"Confirm"}),e.jsx("button",{onClick:l,className:"p-2 bg-gray-100 dark:bg-white/5 rounded-full hover:bg-gray-200 dark:hover:bg-white/10 transition-colors",children:e.jsx(ee,{size:20,className:"text-gray-600 dark:text-gray-400"})})]}),T&&e.jsxs("div",{className:"mb-4 p-4 rounded-3xl flex items-start gap-3 bg-red-50 dark:bg-red-950/20 border border-red-100 dark:border-red-900/30 text-red-600 dark:text-red-400 animate-in shake-1 duration-300",children:[e.jsx(oe,{className:"shrink-0 mt-0.5",size:18}),e.jsx("p",{className:"text-xs font-semibold leading-relaxed",children:T})]}),a==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-royal-50 dark:bg-royal-950/40 p-5 rounded-[32px] border border-royal-100 dark:border-royal-900/30",children:[e.jsx("p",{className:"text-xs font-bold text-royal-600 dark:text-royal-400 mb-2",children:"ðŸ“¸ Shared Meal Mode"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 leading-relaxed",children:"Take a photo of a table with multiple dishes. The AI will identify each dish and let you specify what percentage you ate."})]}),c?e.jsxs("div",{className:"rounded-[32px] overflow-hidden h-64 relative mb-6 shadow-xl border border-white/10",children:[e.jsx("img",{src:c,className:"w-full h-full object-cover",alt:"preview"}),e.jsx("button",{onClick:()=>h(null),className:"absolute top-4 right-4 bg-black/40 text-white p-2 rounded-full backdrop-blur-md",children:e.jsx(ee,{size:20})})]}):e.jsxs("div",{onClick:()=>{var t;return(t=D.current)==null?void 0:t.click()},className:"border-2 border-dashed border-gray-200 dark:border-white/10 rounded-[32px] h-64 flex flex-col items-center justify-center cursor-pointer hover:border-royal-400 hover:bg-royal-50 dark:hover:bg-white/5 transition-all group",children:[e.jsx(Ee,{size:48,className:"text-gray-300 group-hover:text-royal-600 mb-4 transition-colors"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-50 font-bold",children:"Snap or Upload Photo"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1 italic",children:"Capture the whole table"})]}),e.jsx("input",{type:"file",ref:D,accept:"image/*",onChange:H,className:"hidden"}),e.jsx(P,{className:"w-full py-5 text-lg font-black",disabled:!c,onClick:J,children:"Detect Dishes"})]}),a==="analyzing"&&e.jsx(fe,{isActive:!0,message:"Analyzing Shared Meal..."}),a==="selection"&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative rounded-[32px] overflow-hidden border border-white/10 shadow-xl",children:[e.jsx("img",{ref:S,src:c,className:"w-full h-auto object-contain max-h-[400px]",alt:"Shared meal",onLoad:()=>{S.current&&I({width:S.current.offsetWidth,height:S.current.offsetHeight})}}),u.map((t,i)=>{const d=K(t.bounding_box),w=n.has(i);return e.jsx("button",{onClick:()=>Y(i),className:`absolute w-10 h-10 rounded-full flex items-center justify-center transition-all transform -translate-x-1/2 -translate-y-1/2 ${w?"bg-emerald-500 shadow-lg shadow-emerald-500/50 scale-110":"bg-royal-600 shadow-lg shadow-royal-600/50 hover:scale-110"}`,style:{left:`${d.x}px`,top:`${d.y}px`},children:w?e.jsx(De,{size:20,className:"text-white"}):e.jsx("span",{className:"text-white text-xs font-black",children:i+1})},i)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-white/5 rounded-[32px] p-5 border border-gray-100 dark:border-white/5",children:[e.jsxs("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3",children:["Detected Dishes (",u.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto no-scrollbar",children:u.map((t,i)=>e.jsxs("button",{onClick:()=>Y(i),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${n.has(i)?"bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-200 dark:border-emerald-900/30":"bg-white dark:bg-white/5 border border-gray-100 dark:border-white/10 hover:border-royal-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-royal-600 text-white text-xs font-black flex items-center justify-center",children:i+1}),e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-gray-50 truncate",children:t.dish_name})]}),n.has(i)&&e.jsxs("span",{className:"text-xs font-black text-emerald-600 dark:text-emerald-400",children:[n.get(i),"%"]})]},i))})]}),n.size>0&&e.jsxs(P,{className:"w-full py-5 text-lg font-black",onClick:()=>m("confirmation"),children:["Review Selection (",n.size," ",n.size===1?"dish":"dishes",")"]})]}),a==="confirmation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-royal-600 rounded-[32px] p-6 text-white shadow-xl",children:[e.jsx("p",{className:"text-royal-100 text-[10px] font-black uppercase tracking-widest mb-1",children:"Total Calories"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-5xl font-black tracking-tighter",children:X()}),e.jsx("span",{className:"text-xl font-bold opacity-70",children:"kcal"})]}),e.jsxs("p",{className:"text-xs text-white/70 mt-2",children:["From ",n.size," portion",n.size!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3",children:Array.from(n.entries()).map(([t,i])=>{const d=u[t],w=Math.round(d.estimated_total_calories*i/100);return e.jsxs("div",{className:"bg-gray-50 dark:bg-white/5 rounded-2xl p-4 border border-gray-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-gray-50 text-sm",children:d.dish_name}),e.jsxs("span",{className:"text-xs font-black text-royal-600 dark:text-royal-400",children:[i,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:["Portion of ",d.estimated_total_calories," kcal"]}),e.jsxs("span",{className:"font-extrabold text-gray-900 dark:text-gray-50",children:[w," kcal"]})]})]},t)})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{variant:"ghost",className:"flex-1 py-4",onClick:()=>m("selection"),children:"Edit"}),e.jsx(P,{className:"flex-1 py-4 text-lg font-black",onClick:G,isLoading:F,disabled:F,children:"Save All"})]})]}),p!==null&&a==="selection"&&e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-[110] bg-white dark:bg-[#1a1c26] rounded-t-[40px] p-6 shadow-2xl border-t border-white/50 dark:border-white/5 animate-in slide-in-from-bottom duration-300",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-black text-gray-900 dark:text-gray-50",children:u[p].dish_name}),e.jsx("button",{onClick:()=>j(null),className:"p-2 bg-gray-100 dark:bg-white/5 rounded-full",children:e.jsx(Me,{size:20,className:"text-gray-600 dark:text-gray-400"})})]}),e.jsxs("div",{className:"bg-royal-50 dark:bg-royal-950/40 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-royal-600 dark:text-royal-400 uppercase flex items-center gap-1",children:[e.jsx(Fe,{size:14})," Your Portion"]}),e.jsxs("span",{className:"text-2xl font-black text-royal-600 dark:text-royal-400",children:[f,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:f,onChange:t=>v(Number(t.target.value)),className:"w-full h-2 bg-royal-200 dark:bg-royal-900/30 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6 [&::-webkit-slider-thumb]:bg-royal-600 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-white/5 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Your Calories"}),e.jsxs("span",{className:"text-xl font-black text-gray-900 dark:text-gray-50",children:[Math.round(u[p].estimated_total_calories*f/100)," kcal"]})]}),e.jsxs("div",{className:"text-[10px] text-gray-400 mt-1",children:["Total dish: ",u[p].estimated_total_calories," kcal"]})]}),e.jsx(P,{className:"w-full py-4 text-lg font-black",onClick:R,children:"Confirm Selection"})]})})]})})},Ye={sm:{container:"w-10 h-10",face:"w-8 h-8",fontSize:"text-lg"},md:{container:"w-14 h-14",face:"w-11 h-11",fontSize:"text-2xl"},lg:{container:"w-20 h-20",face:"w-16 h-16",fontSize:"text-4xl"}},Qe={[A.OPTIMAL]:{bgGradient:"from-emerald-400 to-green-500",shadow:"shadow-emerald-200 dark:shadow-emerald-900/40",ring:"ring-emerald-300",pulse:!1},[A.WARNING]:{bgGradient:"from-amber-400 to-orange-500",shadow:"shadow-amber-200 dark:shadow-amber-900/40",ring:"ring-amber-300",pulse:!0},[A.CRITICAL]:{bgGradient:"from-red-400 to-rose-600",shadow:"shadow-red-200 dark:shadow-red-900/40",ring:"ring-red-300",pulse:!0}},qe=({size:l="md",showStatus:x=!1,onClick:o})=>{const[a,m]=r.useState(null),[c,h]=r.useState(!1),[u,E]=r.useState(!0),n=r.useCallback(async()=>{try{const f=await ye();m(f)}catch(f){console.error("Failed to load avatar status:",f)}finally{E(!1)}},[]);r.useEffect(()=>{n();const f=we(()=>{n()}),v=()=>{h(!0),setTimeout(()=>h(!1),800)};return window.addEventListener("avatar-feed",v),()=>{f(),window.removeEventListener("avatar-feed",v)}},[n]);const g=Ye[l],p=(a==null?void 0:a.state)||A.WARNING,j=Qe[p];return u?e.jsx("div",{className:`${g.container} rounded-full bg-gray-200 dark:bg-white/10 animate-pulse`}):e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("button",{onClick:o,className:`
          ${g.container} 
          relative rounded-full 
          bg-gradient-to-br ${j.bgGradient}
          shadow-lg ${j.shadow}
          flex items-center justify-center
          transition-all duration-500 ease-out
          hover:scale-110 active:scale-95
          ${j.pulse?"animate-pulse":""}
          ${c?"animate-bounce scale-125":""}
          ${o?"cursor-pointer":"cursor-default"}
        `,disabled:!o,type:"button",children:[e.jsx("div",{className:"absolute inset-1 bg-white/20 rounded-full blur-sm"}),e.jsx("div",{className:`${g.face} relative z-10 flex items-center justify-center`,children:e.jsx(He,{state:p,fontSize:g.fontSize,isFeeding:c})}),c&&e.jsx(Je,{})]}),e.jsx("div",{className:`
        absolute -bottom-0.5 -right-0.5
        w-3 h-3 rounded-full
        border-2 border-white dark:border-[#0c0e17]
        ${p===A.OPTIMAL?"bg-emerald-500":p===A.WARNING?"bg-amber-500":"bg-red-500"}
        ${j.pulse?"animate-ping":""}
      `}),x&&a&&e.jsx("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 
          bg-white dark:bg-[#1a1c26] rounded-xl px-3 py-2 
          shadow-lg border border-gray-100 dark:border-white/10
          whitespace-nowrap z-50
          animate-in fade-in slide-in-from-top-2 duration-300
        `,children:e.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:a.stateReason})})]})},He=({state:l,fontSize:x,isFeeding:o})=>e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"#FFE4C4"}),e.jsx("circle",{cx:"25",cy:"55",r:"8",fill:"#FFB6C1",opacity:"0.5"}),e.jsx("circle",{cx:"75",cy:"55",r:"8",fill:"#FFB6C1",opacity:"0.5"}),l===A.OPTIMAL?e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M30 42 Q35 38 40 42",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M60 42 Q65 38 70 42",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"})]}):l===A.WARNING?e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"35",cy:"42",rx:"6",ry:"7",fill:"#333"}),e.jsx("ellipse",{cx:"65",cy:"42",rx:"6",ry:"7",fill:"#333"}),e.jsx("circle",{cx:"37",cy:"40",r:"2",fill:"white"}),e.jsx("circle",{cx:"67",cy:"40",r:"2",fill:"white"}),e.jsx("path",{d:"M78 35 Q80 40 78 45 Q76 40 78 35",fill:"#87CEEB"})]}):e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"35",cy:"45",rx:"6",ry:"4",fill:"#333"}),e.jsx("ellipse",{cx:"65",cy:"45",rx:"6",ry:"4",fill:"#333"}),e.jsx("path",{d:"M28 38 L42 42",stroke:"#333",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M72 38 L58 42",stroke:"#333",strokeWidth:"2",strokeLinecap:"round"})]}),l===A.OPTIMAL?e.jsx("path",{d:"M35 60 Q50 78 65 60",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}):l===A.WARNING?e.jsx("path",{d:"M35 65 Q42 62 50 65 Q58 68 65 65",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}):e.jsx("path",{d:"M38 68 Q50 60 62 68",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),o&&e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"50",cy:"65",rx:"12",ry:"10",fill:"#FF6B6B"}),e.jsx("ellipse",{cx:"50",cy:"63",rx:"8",ry:"6",fill:"#1a1a1a"})]}),l===A.OPTIMAL&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M15 25 L17 30 L15 35 L13 30 Z",fill:"#FFD700"}),e.jsx("path",{d:"M85 20 L87 25 L85 30 L83 25 Z",fill:"#FFD700"})]})]}),Je=()=>e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-visible",children:[0,1,2,3,4,5].map(l=>e.jsx("div",{className:"absolute animate-ping",style:{left:`${50+Math.cos(l*Math.PI/3)*60}%`,top:`${50+Math.sin(l*Math.PI/3)*60}%`,animationDelay:`${l*.1}s`,animationDuration:"0.6s"},children:e.jsx("span",{className:"text-yellow-400 text-lg",children:"âœ¨"})},l))}),mt=()=>{const[l,x]=r.useState([]),[o,a]=r.useState(!1),[m,c]=r.useState(!1),[h,u]=r.useState(null),[E,n]=r.useState(null),[g,p]=r.useState(0),[j,f]=r.useState(0),[v,T]=r.useState(0),[C,F]=r.useState(0),[k,D]=r.useState(2e3),[S,te]=r.useState(0),[I,H]=r.useState(!0),[J,K]=r.useState(""),[Y,R]=r.useState(!1),[X,G]=r.useState(null),[t,i]=r.useState(0),[d,w]=r.useState(null),[$,_]=r.useState(!1),N=async()=>{try{const s=await ce(),b=re(),y=s.filter(z=>z.date===b);y.sort((z,M)=>M.timestamp.localeCompare(z.timestamp)),x(y),p(y.reduce((z,M)=>z+M.calories,0)),f(y.reduce((z,M)=>z+(M.protein||0),0)),T(y.reduce((z,M)=>z+(M.carbs||0),0)),F(y.reduce((z,M)=>z+(M.fat||0),0));const O=await xe();D(O);const Q=await me();Q!=null&&Q.name&&K(Q.name);const ne=await Ce();i(ne.currentStreak);const ie=await ze();w(ie)}catch(s){console.error("Failed to load dashboard data",s)}finally{H(!1)}};r.useEffect(()=>{N();const s=()=>N();window.addEventListener("food-entry-updated",s);const b=()=>N();window.addEventListener("streak-updated",b);const y=()=>{console.log("ðŸ“Š Dashboard: Midnight detected, reloading data..."),N()};return window.addEventListener("midnight-refresh",y),()=>{window.removeEventListener("food-entry-updated",s),window.removeEventListener("streak-updated",b),window.removeEventListener("midnight-refresh",y)}},[]),r.useEffect(()=>{if(I)return;const s=Math.min(g/k*100,100),b=setTimeout(()=>{te(s)},100);return()=>clearTimeout(b)},[g,k,I]);const U=async s=>{await ge(s),await N()},B=s=>{u(null),n(s),a(!0)},Z=async s=>{await ue(s),D(s),c(!1)},W=()=>{const s=g/k*100;if(s>=100)return{background:"repeating-linear-gradient(45deg, #facc15, #facc15 12px, #171717 12px, #171717 24px)",boxShadow:"0 0 12px rgba(250, 204, 21, 0.4)"};if(s<=60)return{background:"#10b981",boxShadow:"0 0 12px rgba(16, 185, 129, 0.4)"};if(s<=80)return{background:`linear-gradient(90deg, #10b981 0%, #10b981 ${60/s*100}%, #facc15 100%)`,boxShadow:"0 0 12px rgba(250, 204, 21, 0.3)"};const b=60/s*100,y=80/s*100;return{background:`linear-gradient(90deg, #10b981 0%, #10b981 ${b}%, #facc15 ${y}%, #f97316 100%)`,boxShadow:"0 0 12px rgba(249, 115, 22, 0.3)"}},V=s=>{if(s.isManual)return s.imageUrl?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-50 dark:bg-amber-950/20 text-amber-600 dark:text-amber-400 text-[10px] font-bold tracking-wide",children:[e.jsx(Pe,{size:10}),"EDITED"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gray-100 dark:bg-white/5 text-gray-500 dark:text-gray-400 text-[10px] font-bold tracking-wide",children:[e.jsx(se,{size:10}),"MANUAL"]});const b=Math.round(s.confidence*100),y=b>80?"bg-emerald-50 dark:bg-emerald-950/20 text-emerald-600 dark:text-emerald-400":b>50?"bg-orange-50 dark:bg-orange-950/20 text-orange-600 dark:text-orange-400":"bg-rose-50 dark:bg-rose-950/20 text-rose-600 dark:text-rose-400";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold tracking-wide ${y}`,children:[e.jsx(he,{size:10}),b,"% AI"]})};return e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 animate-in fade-in duration-500 overflow-hidden relative",children:[e.jsxs("div",{className:"flex-shrink-0 px-6 pt-6 sm:pt-10 space-y-4 sm:space-y-8 pb-4",children:[e.jsxs("header",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-xs font-semibold uppercase tracking-widest mb-2",children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-extrabold text-gray-900 dark:text-gray-50 tracking-tight leading-tight sm:leading-none",children:["Hello ",J||"there",", ",e.jsx("br",{}),"Let's Eat Well."]})]}),e.jsx("div",{className:"relative",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),children:e.jsx(qe,{size:"md",showStatus:$})})]}),t>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white px-4 py-2.5 rounded-2xl shadow-lg shadow-orange-200 dark:shadow-orange-900/30 animate-in slide-in-from-left duration-500",children:[e.jsx(Le,{size:20,className:"animate-pulse"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xl font-extrabold",children:t}),e.jsx("span",{className:"ml-1.5 text-sm font-bold text-white/90",children:"day streak!"})]}),t>=7&&t<14&&e.jsx("span",{className:"ml-2 text-xs bg-white/20 px-2 py-0.5 rounded-full",children:"ðŸ”¥ Keep it up!"}),t>=14&&t<30&&e.jsx("span",{className:"ml-2 text-xs bg-white/20 px-2 py-0.5 rounded-full",children:"ðŸš€ On fire!"}),t>=30&&e.jsx("span",{className:"ml-2 text-xs bg-white/20 px-2 py-0.5 rounded-full",children:"ðŸ‘‘ Legend!"})]}),e.jsxs("div",{className:`relative rounded-[28px] sm:rounded-[32px] p-5 sm:p-6 text-white overflow-hidden shadow-xl transition-all duration-500 ${g>k?"bg-red-500 shadow-red-200 dark:shadow-red-900/40":"bg-royal-600 shadow-royal-200 dark:shadow-royal-900/40"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-10 -ml-10 w-40 h-40 bg-black/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-xs font-bold uppercase tracking-widest mb-1",children:"Calories Consumed"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-4xl sm:text-5xl font-bold tracking-tighter",children:I?"...":g}),e.jsx("span",{className:"text-base sm:text-lg text-white/60 font-medium",children:"kcal"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 text-white/80 mb-1",children:[e.jsxs("span",{className:"text-xs font-semibold",children:["Goal: ",k]}),e.jsx("button",{onClick:()=>c(!0),className:"p-1.5 rounded-full bg-white/20 hover:bg-white/30 transition-colors backdrop-blur-sm",children:e.jsx(je,{size:10})})]})})]}),e.jsx("div",{className:"w-full bg-black/20 rounded-full h-4 mb-3 overflow-hidden backdrop-blur-sm relative",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-1000 ease-out will-change-[width] flex items-center justify-center overflow-hidden",style:{width:`${S}%`,...W()},children:g/k>=1&&e.jsx("span",{className:"text-[10px] font-black tracking-tighter text-white drop-shadow-md animate-pulse",children:"OVER LIMIT"})})}),e.jsx("div",{className:"flex justify-end mb-4 sm:mb-6",children:g>k?e.jsxs("div",{className:"flex items-center gap-1.5 bg-white/20 backdrop-blur-md px-3 py-1 rounded-full animate-pulse",children:[e.jsx(_e,{size:14,className:"text-white",fill:"white"}),e.jsxs("span",{className:"font-bold text-xs text-white",children:[Math.abs(k-g).toLocaleString()," kcal over limit"]})]}):e.jsxs("p",{className:"text-xs font-medium text-white/80",children:[Math.max(k-g,0).toLocaleString()," kcal remaining"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 mt-4 sm:mt-5 pt-3 sm:pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-1.5 sm:p-2 rounded-xl sm:rounded-2xl bg-emerald-500/15 border-t-2 border-t-emerald-400 border-x border-b border-emerald-500/20 shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-400/20 to-transparent opacity-50"}),e.jsx("p",{className:"text-[8px] sm:text-[9px] uppercase font-bold text-emerald-400 mb-0.5 relative z-10 tracking-wider",children:"Protein"}),e.jsxs("div",{className:"flex items-baseline gap-0.5 relative z-10",children:[e.jsx("span",{className:"text-lg sm:text-xl font-black text-white drop-shadow-md",children:j}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-bold text-emerald-300",children:"g"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-1.5 sm:p-2 rounded-xl sm:rounded-2xl bg-amber-500/15 border-t-2 border-t-amber-400 border-x border-b border-amber-500/20 shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-400/20 to-transparent opacity-50"}),e.jsx("p",{className:"text-[8px] sm:text-[9px] uppercase font-bold text-amber-400 mb-0.5 relative z-10 tracking-wider",children:"Carbs"}),e.jsxs("div",{className:"flex items-baseline gap-0.5 relative z-10",children:[e.jsx("span",{className:"text-lg sm:text-xl font-black text-white drop-shadow-md",children:v}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-bold text-amber-300",children:"g"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-1.5 sm:p-2 rounded-xl sm:rounded-2xl bg-rose-500/15 border-t-2 border-t-rose-400 border-x border-b border-rose-500/20 shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-rose-400/20 to-transparent opacity-50"}),e.jsx("p",{className:"text-[8px] sm:text-[9px] uppercase font-bold text-rose-400 mb-0.5 relative z-10 tracking-wider",children:"Fat"}),e.jsxs("div",{className:"flex items-baseline gap-0.5 relative z-10",children:[e.jsx("span",{className:"text-lg sm:text-xl font-black text-white drop-shadow-md",children:C}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-bold text-rose-300",children:"g"})]})]})]}),d&&d.daysRemaining>0&&e.jsxs("div",{className:"mt-4 sm:mt-5 pt-3 sm:pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{size:14,className:"text-white/70"}),e.jsx("span",{className:"text-xs font-bold text-white/70 uppercase tracking-wider",children:"Weight Goal"})]}),e.jsxs("span",{className:"text-xs font-bold text-white/90",children:[d.currentWeight,"kg â†’ ",d.targetWeight,"kg"]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 mb-2 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-emerald-400 to-green-500 transition-all duration-1000",style:{width:`${d.progressPercentage}%`}})}),e.jsx("p",{className:"text-xs text-white/80 font-medium leading-relaxed",children:ke(d)})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 px-6 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-50",children:"Recent Meals"}),e.jsxs("span",{className:"text-xs font-medium text-gray-400 dark:text-gray-500 bg-gray-100 dark:bg-white/5 px-2 py-1 rounded-lg",children:[l.length," items"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar px-6 pb-32",children:I?e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx("div",{className:"h-24 bg-white dark:bg-[#1a1c26] rounded-[32px] animate-pulse shadow-sm border border-white/5 dark:border-white/5"},s))}):l.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-[#1a1c26] rounded-[32px] border border-gray-100 dark:border-white/5 shadow-diffused dark:shadow-diffused-dark",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 dark:bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4 text-gray-300 dark:text-gray-700",children:e.jsx(ve,{size:24})}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 font-medium mb-1",children:"No meals tracked today."}),e.jsx("p",{className:"text-xs text-gray-300 dark:text-gray-700",children:"Tap the + button to add one."})]}):e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsxs(pe,{className:"flex gap-4 items-center p-4 group",onClick:()=>u(s),children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 dark:bg-white/5 rounded-2xl overflow-hidden flex-shrink-0 shadow-inner",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.food_item,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-300 dark:text-gray-700",children:e.jsx(se,{size:20})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"font-bold text-gray-900 dark:text-gray-50 truncate text-base",children:s.food_item})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500",children:s.time}),V(s)]})]}),e.jsxs("div",{className:"text-right pl-2",children:[e.jsx("span",{className:"block font-extrabold text-gray-900 dark:text-gray-50 text-lg",children:s.calories}),e.jsx("span",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase",children:"kcal"})]})]},s.id))})}),e.jsx("button",{onClick:()=>{n(null),a(!0)},className:"absolute bottom-28 right-6 w-16 h-16 bg-royal-600 text-white rounded-[24px] shadow-[0_12px_24px_-6px_rgba(124,58,237,0.5)] flex items-center justify-center hover:scale-105 hover:bg-royal-700 active:scale-95 transition-all z-[60]",children:e.jsx(Te,{size:32,strokeWidth:2.5})}),o&&e.jsx(Ne,{editEntry:E,onClose:()=>{a(!1),n(null)},onSuccess:()=>{a(!1),n(null),N()},onOpenSharedMeal:s=>{a(!1),n(null),s&&G(s),setTimeout(()=>R(!0),100)}}),m&&e.jsx(Re,{currentGoal:k,onClose:()=>c(!1),onSave:Z}),h&&e.jsx(Se,{entry:h,onClose:()=>u(null),onDelete:U,onEdit:B}),Y&&e.jsx(Oe,{initialImage:X,onClose:()=>{R(!1),G(null)},onSuccess:()=>{R(!1),G(null),N()}})]})};export{mt as Dashboard};
