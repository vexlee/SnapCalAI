import{c as q,d as oe,b as ne,h as ie,i as le,j as e,k as ce,l as F,S as de,m as ge,g as U,n as ue,o as me,p as he,q as S,r as ye}from"./index-CE3ZF4U7.js";import{r as x}from"./vendor-react-wGySg1uH.js";import{C as A}from"./Card-C5vMR-fW.js";import{G as pe}from"./index-cQ6qJtkF.js";import{g as K,S as H}from"./workoutTypes-BWu6Z9tJ.js";import{X as xe}from"./x-DNR7s20F.js";import{L as M}from"./loader-2-Cg8Sx650.js";import{C as fe}from"./check-Bzi2enzb.js";import{P as be}from"./plus-B6vn2DiR.js";import"./vendor-charts-Bdt_fL2G.js";import"./vendor-supabase-DfwcnzK-.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=q("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=q("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ke=()=>"AIzaSyBe0v3rn4bATheRJCE77AmY58Op-tiJJVU",ve=()=>{const t=ke();return new pe({apiKey:t})},je=`You are **Cal Coach**, an AI fitness and nutrition coach. Your mission is to provide professional, actionable advice to help users reach their goals.

**Core Principles:**
1. **Keep it Simple:** Use short, clear sentences. No jargon or complicated explanations.
2. **Focus on What Matters:** Only highlight the most important insights and actions.
3. **Be Encouraging:** Always stay positive and supportive, even when pointing out areas for improvement.
4. **Card-Friendly Format:** Structure responses to be visually scannable with emojis, bullet points, and short sections.

**Response Guidelines:**

When analyzing nutrition:
- Start with a simple status emoji (âœ… Good / âš ï¸ Needs Work / ðŸ”¥ Excellent)
- Show only the most critical metrics (Calories, Protein)
- Use 2-3 bullet points max for observation
- Give 2-3 actionable next steps
- Keep total response under 150 words

When providing plans (workout/meal):
- Use simple bullet format, not complex tables
- Show only key exercises or meals (3-5 items max)
- Include specific numbers (reps, grams, servings)
- Add emoji indicators for visual appeal

When answering workout/calorie burn questions:
- ALWAYS reference the user's actual logged workouts from the context provided
- Use the specific workout type, duration, and estimated calorie burn from the data
- If no workouts are logged for that day, say so and offer to help create a workout plan
- Don't make generic estimates - use the provided workout data

When answering other questions:
- Answer directly in 2-3 sentences
- Add one practical example if needed
- No lengthy explanations

**Formatting Style:**
âœ… **Status**
Brief one-line summary

**Key Points:**
â€¢ Point 1 with number
â€¢ Point 2 with number
â€¢ Point 3 with number

**Action Steps:**
1. Simple action
2. Simple action

**Never:**
- Use complex tables with multiple columns
- Write long paragraphs
- Include technical disclaimers (assume user knows to consult doctors)
- Use phases like "Phase 1", "Phase 2"
- Repeat the user's data back to them
- Make up workout data - only reference what's in the provided context

**Context Provided:**
You will receive user profile data, recent food tracking history, AND workout data in each message. Use this to provide personalized analysis and recommendations. For workout-related questions, always check the "Recent Workouts" section first.`,De=(t,s=70)=>{const a=s/70;switch(t){case"cardio":return 10*a;case"strength":return 6*a;case"flexibility":return 3.5*a;case"sports":return 8*a;default:return 5*a}},Ne=t=>{let s=0;return t.forEach(a=>{let n=60;if(a.rest){const o=a.rest.match(/(\d+)\s*(s|sec|min|m)/i);o&&(n=parseInt(o[1])*(o[2].toLowerCase().startsWith("m")?60:1))}let l=45;if(a.reps){const o=a.reps.toLowerCase();if(o.includes("min")){const i=o.match(/(\d+)/);i&&(l=parseInt(i[1])*60)}else if(o.includes("sec")||o.includes("s hold")){const i=o.match(/(\d+)/);i&&(l=parseInt(i[1]))}}s+=(l+n)*a.sets/60}),Math.round(s)},Ce=(t,s=70)=>{const a=t.workoutTypeId?K(t.workoutTypeId):void 0,n=a==null?void 0:a.category,l=t.exercises.length,o=t.exercises.filter(d=>d.completed).length,i=Ne(t.exercises),c=De(n,s),v=Math.round(i*c);return{date:t.date,title:t.title,workoutType:a==null?void 0:a.name,category:n,exerciseCount:l,completedCount:o,estimatedDurationMin:i,estimatedCaloriesBurned:v}},O=async()=>{try{const t={},s=await oe();s&&(t.userName=s.name,t.height=s.height,t.weight=s.weight,t.age=s.age,t.gender=s.gender,t.activityLevel=s.activityLevel,t.goal=s.goal,t.equipmentAccess=s.equipmentAccess);const a=await ne();t.dailyGoal=a;const n=await ie(),l=new Date().toISOString().split("T")[0],o=n.filter(d=>d.date===l);t.todayCalories=o.reduce((d,g)=>d+g.calories,0),t.todayProtein=o.reduce((d,g)=>d+g.protein,0),t.todayCarbs=o.reduce((d,g)=>d+g.carbs,0),t.todayFat=o.reduce((d,g)=>d+g.fat,0);const i=new Map;n.forEach(d=>{i.has(d.date)||i.set(d.date,[]),i.get(d.date).push(d)}),t.recentEntries=Array.from(i.entries()).slice(0,30).map(([d,g])=>({date:d,totalCalories:g.reduce((u,w)=>u+w.calories,0),totalProtein:g.reduce((u,w)=>u+w.protein,0),totalCarbs:g.reduce((u,w)=>u+w.carbs,0),totalFat:g.reduce((u,w)=>u+w.fat,0),entryCount:g.length}));const c=[],v=(s==null?void 0:s.weight)||70;for(let d=0;d<7;d++){const g=new Date;g.setDate(g.getDate()-d);const u=g.toISOString().split("T")[0];try{(await le(u)).forEach(D=>{c.push(Ce(D,v))})}catch(w){console.warn(`Failed to fetch workouts for ${u}:`,w)}}return t.recentWorkouts=c,t}catch(t){return console.error("Failed to build coach context:",t),{}}},Se=t=>{let s=`**User Profile & Current Data:**

`;return t.userName&&(s+=`- Name: ${t.userName}
`),t.height&&(s+=`- Height: ${t.height} cm
`),t.weight&&(s+=`- Weight: ${t.weight} kg
`),t.age&&(s+=`- Age: ${t.age} years
`),t.gender&&(s+=`- Gender: ${t.gender.charAt(0).toUpperCase()+t.gender.slice(1)}
`),t.activityLevel&&(s+=`- Activity Level: ${{sedentary:"Sedentary",light:"Lightly Active",moderate:"Moderately Active",very:"Very Active",extra:"Extra Active"}[t.activityLevel]}
`),t.goal&&(s+=`- Goal: ${{cut:"Cut (Lose Fat)",bulk:"Bulk (Gain Muscle)",maintain:"Maintain"}[t.goal]}
`),t.equipmentAccess&&(s+=`- Equipment: ${{gym:"Gym Access",home:"Home Equipment",bodyweight:"Bodyweight Only"}[t.equipmentAccess]}
`),t.dailyGoal&&(s+=`- Daily Calorie Goal: ${t.dailyGoal} kcal
`),s+=`
**Today's Nutrition (${new Date().toLocaleDateString()}):**
`,s+=`- Calories: ${t.todayCalories||0} kcal
`,s+=`- Protein: ${t.todayProtein||0}g
`,s+=`- Carbs: ${t.todayCarbs||0}g
`,s+=`- Fat: ${t.todayFat||0}g
`,t.recentEntries&&t.recentEntries.length>0&&(s+=`
**Last 7 Days Nutrition Summary:**
`,t.recentEntries.slice(0,7).forEach(a=>{s+=`
${a.date}:
`,s+=`  - ${a.totalCalories} kcal | Protein: ${a.totalProtein}g | Carbs: ${a.totalCarbs}g | Fat: ${a.totalFat}g | Meals: ${a.entryCount}
`})),t.recentWorkouts&&t.recentWorkouts.length>0?(s+=`
**Recent Workouts (Last 7 Days):**
`,t.recentWorkouts.forEach(a=>{const n=a.completedCount===a.exerciseCount?"âœ…":a.completedCount>0?"ðŸ”„":"ðŸ“‹";s+=`
${a.date} - ${n} ${a.title}:
`,a.workoutType&&(s+=`  - Type: ${a.workoutType} (${a.category})
`),s+=`  - Exercises: ${a.completedCount}/${a.exerciseCount} completed
`,s+=`  - Estimated Duration: ${a.estimatedDurationMin} min
`,s+=`  - Estimated Calories Burned: ${a.estimatedCaloriesBurned} kcal
`})):s+=`
**Recent Workouts:** No workouts logged in the last 7 days.
`,s+=`
---

`,s},I=async(t,s)=>{try{const a=ve(),n=await O(),l=s.slice(-4).map(c=>`${c.role==="user"?"User":"Coach"}: ${c.content}`).join(`

`),o=`${Se(n)}${l?`**Recent Conversation:**
${l}

`:""}**User's Current Message:**
${t}`;return(await a.models.generateContent({model:"gemini-3-flash-preview",contents:[{parts:[{text:o}]}],config:{systemInstruction:je,temperature:.7,topP:.95}})).text||"I apologize, but I couldn't generate a response. Please try again."}catch(a){console.error("Coach message error:",a);const n=(a==null?void 0:a.message)||String(a);throw n.includes("429")||n.toLowerCase().includes("quota")?new Error("Rate limit reached. Please wait a moment and try again."):n.toLowerCase().includes("api key")?new Error("Configuration error. Please check your API settings."):new Error("Failed to get coach response. Please try again.")}},$e=t=>{t.toLowerCase();const s=/\b(workout|exercise|training|routine|fitness|gym)\b/i.test(t),a=/day\s+\d+:/i.test(t),n=/\d+\s*(sets?|reps?|x)/i.test(t)||/sets?:\s*\d+/i.test(t)||/\d+\s*x\s*\d+/i.test(t),l=/(push-?up|pull-?up|squat|deadlift|bench\s+press|plank|lunge|curl|press|row)/i.test(t);return s&&(n||a||l)},G=t=>{const s=[];let a="AI Workout Plan";const n=t.match(/(?:^|\n)(?:##?\s*)?([A-Z][\w\s&]+(?:Day|Workout|Training|Routine))/i);n&&(a=n[1].trim());const l=t.split(`
`).map(o=>o.trim());for(let o=0;o<l.length;o++){const i=l[o];if(!i||i.startsWith("#")||i.startsWith("**Action")||i.startsWith("**Key"))continue;let c="",v=3,d="10",g="60s",u=i.replace(/^[â€¢\-\*]\s*/,"").replace(/^\d+\.\s*/,"");const w=u.match(/(\d+)\s*(?:sets?|x)/i)||u.match(/sets?:\s*(\d+)/i);w&&(v=parseInt(w[1]));const D=u.match(/(\d+(?:-\d+)?)\s*reps?/i)||u.match(/reps?:\s*(\d+(?:-\d+)?)/i);if(D)d=D[1];else{const N=u.match(/\dx(\d+(?:-\d+)?)/i);N&&(d=N[1])}const C=u.match(/(\d+(?:s|sec|seconds?|min|minutes?))/i)||u.match(/rest:\s*(\d+(?:s|sec|min)?)/i);C&&(g=C[1].toLowerCase().replace("seconds","s").replace("sec","s").replace("minutes","min").replace("minute","min"));const k=u.match(/^([A-Za-z][\w\s\-'()]+?)(?:\s*[-:|]|\s+\d)/);k?c=k[1].trim():/^[A-Za-z][\w\s\-'()]+$/.test(u)&&u.length<50&&(c=u),c&&!c.match(/^(sets?|reps?|rest|action|next|step)/i)&&s.push({id:`ex-${Date.now()}-${s.length}`,name:c,sets:v,reps:d,rest:g,completed:!1})}return{title:a,exercises:s}},Me=t=>{const s=/Day\s+(\d+):?\s*(.+?)(?=Day\s+\d+:|$)/gis,a=Array.from(t.matchAll(s));if(a.length<2){const{title:l,exercises:o}=G(t);return{isMultiDay:!1,days:[{dayNumber:1,title:l,exercises:o,isRestDay:o.length===0}]}}const n=a.map(l=>{const o=parseInt(l[1]),i=l[2].trim(),c=/^(rest|recovery|off)\s*$/i.test(i)||i.toLowerCase().includes("rest day"),v=i.match(/repeat\s+day\s+(\d+)/i);if(c)return{dayNumber:o,title:"Rest Day",exercises:[],isRestDay:!0};if(v)return{dayNumber:o,title:i,exercises:[],isRestDay:!1,repeatsDayNumber:parseInt(v[1])};const{title:d,exercises:g}=G(i);return{dayNumber:o,title:d==="AI Workout Plan"?i.split(`
`)[0]:d,exercises:g,isRestDay:g.length===0}});return n.forEach(l=>{if(l.repeatsDayNumber){const o=l.repeatsDayNumber,i=n.find(c=>c.dayNumber===o);i&&(l.title=i.title,l.exercises=i.exercises.map(c=>({...c,id:`ex-${Date.now()}-${Math.random()}`}))),delete l.repeatsDayNumber}}),{isMultiDay:!0,days:n}},Ae={walk:"walking",walking:"walking",run:"running",running:"running",jog:"running",jogging:"running",sprint:"running",cycle:"cycling",cycling:"cycling",bike:"cycling",biking:"cycling",hiit:"hiit",gym:"full-body",lift:"full-body",lifting:"full-body",weights:"full-body",strength:"full-body","upper body":"upper-body","lower body":"lower-body",core:"core",abs:"core",yoga:"yoga",stretch:"stretching",stretching:"stretching",pilates:"pilates",swim:"swimming",swimming:"swimming",dance:"dance",dancing:"dance"},Pe=t=>[/(\d+)\s*[-â€“]?\s*(minute|min|hour|hr)s?\s+(walk|walking|run|running|jog|jogging|cycle|cycling|bike|biking|swim|swimming|yoga|hiit|stretch|stretching|gym|lift|lifting|dance|dancing)/i,/(walk|walking|run|running|jog|jogging|cycle|cycling|bike|biking|swim|swimming|yoga|hiit|stretch|stretching|gym|lift|lifting|dance|dancing)\s+(?:for\s+)?(\d+)\s*[-â€“]?\s*(minute|min|hour|hr)s?/i].some(a=>a.test(t)),Ie=t=>{const s=/(\d+)\s*[-â€“]?\s*(minute|min|hour|hr)s?\s+(walk|walking|run|running|jog|jogging|cycle|cycling|bike|biking|swim|swimming|yoga|hiit|stretch|stretching|gym|lift|lifting|dance|dancing)/i,a=/(walk|walking|run|running|jog|jogging|cycle|cycling|bike|biking|swim|swimming|yoga|hiit|stretch|stretching|gym|lift|lifting|dance|dancing)\s+(?:for\s+)?(\d+)\s*[-â€“]?\s*(minute|min|hour|hr)s?/i;let n=0,l="",o="min";const i=t.match(s),c=t.match(a);if(i)n=parseInt(i[1]),o=i[2].toLowerCase(),l=i[3].toLowerCase();else if(c)l=c[1].toLowerCase(),n=parseInt(c[2]),o=c[3].toLowerCase();else return null;(o.startsWith("hour")||o==="hr")&&(n=n*60);const v=Ae[l]||"full-body",d=l.charAt(0).toUpperCase()+l.slice(1),g=`${n} min ${d}`;return{originalText:t,activity:l,durationMin:n,workoutTypeId:v,title:g}},We=t=>{const s=[],a=t.split(`
`);for(const n of a)if(Pe(n)){const l=Ie(n);l&&s.push(l)}return s},Le=({isOpen:t,onClose:s,workoutText:a})=>{const[n,l]=x.useState(new Date().toISOString().split("T")[0]),[o,i]=x.useState(!1),[c,v]=x.useState(null);if(x.useEffect(()=>{if(t&&a){const k=Me(a);v(k)}},[t,a]),!t)return null;const d=async()=>{if(c){i(!0);try{await ce(n,c.days);const k=c.days.length,N=c.isMultiDay?`${k}-day`:"single-day";alert(`${N} workout plan saved successfully! Go check it out in the Workout Plan page.`),s()}catch(k){console.error("Failed to save workout:",k),alert("Failed to save workout plan")}finally{i(!1)}}},g=()=>{if(!c||!c.isMultiDay)return null;const k=new Date(n),N=new Date(k);return N.setDate(N.getDate()+c.days.length-1),N.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},u=new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),w=g(),D=(c==null?void 0:c.days.length)||0,C=(c==null?void 0:c.isMultiDay)||!1;return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-300 px-6",children:e.jsxs(A,{className:"w-full max-w-md animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 dark:border-white/10",children:[e.jsx("h2",{className:"text-xl font-extrabold text-gray-900 dark:text-gray-50",children:"Save Workout Plan"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-white/5 rounded-full transition-colors",children:e.jsx(xe,{size:20,className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[C&&e.jsxs("div",{className:"p-4 bg-royal-50 dark:bg-royal-950/20 border-2 border-royal-200 dark:border-royal-800/50 rounded-xl",children:[e.jsxs("p",{className:"text-sm font-bold text-royal-900 dark:text-royal-100 mb-1",children:["ðŸ“… ",D,"-Day Workout Plan"]}),e.jsxs("p",{className:"text-xs text-royal-700 dark:text-royal-300",children:["Will be saved from ",e.jsx("strong",{children:u})," to ",e.jsx("strong",{children:w})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:C?"Choose Start Date":"Choose Date"}),e.jsx("input",{type:"date",value:n,onChange:k=>l(k.target.value),className:"w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border-2 border-gray-200 dark:border-white/10 rounded-xl text-gray-900 dark:text-gray-50 focus:outline-none focus:border-royal-500 dark:focus:border-royal-400 transition-colors"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:C?`Select the first day of your ${D}-day plan`:"Select which day you want to use this workout plan"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-100 dark:border-white/10",children:[e.jsx("button",{onClick:s,disabled:o,className:"px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-white/5 rounded-xl font-semibold transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:d,disabled:o,className:"flex items-center gap-2 px-6 py-3 bg-royal-600 hover:bg-royal-700 text-white rounded-xl font-semibold transition-colors disabled:opacity-50 shadow-lg shadow-royal-200 dark:shadow-royal-900/40",children:[e.jsx(H,{size:18}),e.jsx("span",{children:o?"Saving...":C?`Save ${D}-Day Plan`:"Save Plan"})]})]})]})})},Oe=({onNavigate:t})=>{const[s,a]=x.useState([]),[n,l]=x.useState(""),[o,i]=x.useState(!1),[c,v]=x.useState(null),[d,g]=x.useState(!1),[u,w]=x.useState(new Set),[D,C]=x.useState(!1),[k,N]=x.useState(!0),[Y,W]=x.useState(!1),[V,_]=x.useState(""),[Z,L]=x.useState(null),[T,J]=x.useState(new Set),z=x.useRef(null),B=x.useRef(null),P=x.useRef(null),Q=r=>!!(r.activityLevel&&r.goal&&r.equipmentAccess);x.useEffect(()=>{(async()=>{const p=await O();if(v(p),!Q(p)){g(!0);return}await ge();const m=U(),h=await ue();if(h.length>0)a(h),w(new Set([m]));else{const f={id:crypto.randomUUID(),role:"assistant",content:`ðŸ‘‹ ** Hi ${p.userName||"there"} !I'm Cal Coach.**

How can I help you today?`,timestamp:Date.now()};a([f])}})()},[]),x.useEffect(()=>{var r;(r=z.current)==null||r.scrollIntoView({behavior:"smooth"})},[s]);const E=async()=>{var p;if(!n.trim()||o)return;const r={id:crypto.randomUUID(),role:"user",content:n,timestamp:Date.now()};a(m=>[...m,r]),l(""),i(!0),S(r).catch(m=>console.error("Failed to save user message:",m));try{const m=await I(n,s),h={id:crypto.randomUUID(),role:"assistant",content:m,timestamp:Date.now()};a(f=>[...f,h]),S(h).catch(f=>console.error("Failed to save assistant message:",f))}catch(m){const h={id:crypto.randomUUID(),role:"assistant",content:`âš ï¸ ${m.message||"Failed to get response. Please try again."}`,timestamp:Date.now()};a(f=>[...f,h])}finally{i(!1),(p=B.current)==null||p.focus()}},X=r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),E())},ee=()=>{t(me.PROFILE)},te=async r=>{const p=`${r.activity}-${r.durationMin}`;if(!T.has(p)){L(p);try{const m=U(),h=K(r.workoutTypeId),f=[{id:`ex-${Date.now()}-0`,name:r.title,sets:1,reps:`${r.durationMin} min`,rest:"0s",completed:!1}];await he(m,(h==null?void 0:h.name)||r.title,f,void 0,r.workoutTypeId),J(y=>new Set([...y,p]))}catch(m){console.error("Failed to add workout:",m)}finally{L(null)}}},ae=async()=>{if(!(D||!k)){C(!0);try{const p=Array.from(u).sort()[0];if(!p){N(!1);return}const m=new Date(p);m.setDate(m.getDate()-1);const h=m.toISOString().split("T")[0],f=new Date().toISOString().split("T")[0];if(Math.floor((new Date(f).getTime()-new Date(h).getTime())/(1e3*60*60*24))>=30){N(!1);return}const j=await ye(h);if(j.length>0){const b=P.current,re=(b==null?void 0:b.scrollHeight)||0;a($=>[...j,...$]),w($=>new Set([...$,h])),setTimeout(()=>{if(b){const $=b.scrollHeight;b.scrollTop=$-re}},0)}else w(b=>new Set([...b,h]))}catch(r){console.error("Failed to load previous day messages:",r)}finally{C(!1)}}},se=()=>{const r=P.current;if(!r)return;const p=u.size>0;r.scrollTop<100&&!D&&k&&p&&ae()};return d?e.jsx("div",{className:"flex-1 flex flex-col min-h-0 px-6 pt-10 pb-32 animate-in fade-in duration-500",children:e.jsx("div",{className:"flex-1 flex items-center justify-center px-6",children:e.jsxs(A,{className:"p-8 max-w-md w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-10 -mr-10 w-32 h-32 bg-royal-100 dark:bg-royal-950/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-10 -ml-10 w-32 h-32 bg-royal-100 dark:bg-royal-950/20 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-royal-500 to-royal-700 rounded-full flex items-center justify-center text-white shadow-lg mx-auto mb-6",children:e.jsx(R,{size:32})}),e.jsx("h2",{className:"text-2xl font-extrabold text-gray-900 dark:text-gray-50 text-center mb-3",children:"Set Your Training Goals"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-center mb-6 leading-relaxed",children:["To provide you with personalized AI coaching, please complete your"," ",e.jsx("span",{className:"font-bold text-royal-600 dark:text-royal-400",children:"Training Goal Setting"})," ","in your Profile."]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-white/5 rounded-2xl p-4 mb-6",children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3",children:"We need to know:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-royal-600 dark:text-royal-400 mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Your activity level (sedentary to extra active)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-royal-600 dark:text-royal-400 mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Your fitness goal (cut, bulk, or maintain)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-royal-600 dark:text-royal-400 mt-0.5",children:"â€¢"}),e.jsx("span",{children:"Your equipment access (gym, home, or bodyweight)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:ee,className:"w-full flex items-center justify-center gap-2 py-4 bg-royal-600 hover:bg-royal-700 text-white rounded-[20px] font-bold transition-all shadow-lg shadow-royal-200 dark:shadow-royal-900/40 active:scale-95",children:[e.jsx(R,{size:20}),e.jsx("span",{children:"Go to Profile"}),e.jsx(F,{size:20})]}),e.jsx("button",{onClick:()=>g(!1),className:"w-full py-3 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-[20px] font-semibold transition-all text-sm",children:"I'll do this later"})]})]})]})})}):e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 px-6 pt-10 pb-32 animate-in fade-in duration-500",children:[e.jsxs("header",{className:"flex justify-between items-end mb-6 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-xs font-semibold uppercase tracking-widest mb-2",children:"Your Personal Coach"}),e.jsx("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-gray-50 tracking-tight leading-none",children:"Cal Coach"})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-royal-500 to-royal-700 rounded-full flex items-center justify-center text-white shadow-sm",children:e.jsx(de,{size:20})})]}),e.jsxs("div",{ref:P,onScroll:se,className:"flex-1 overflow-y-auto space-y-4 mb-4 no-scrollbar",children:[D&&e.jsx("div",{className:"flex justify-center py-3 animate-in fade-in duration-300",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 dark:text-gray-500 text-sm",children:[e.jsx(M,{size:14,className:"animate-spin"}),e.jsx("span",{children:"Loading previous messages..."})]})}),!D&&k&&s.length>1&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:"â†‘ Scroll up to load older messages"})}),s.map(r=>e.jsx("div",{className:`flex ${r.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:e.jsx("div",{className:`max-w-[85%] ${r.role==="user"?"bg-royal-600 text-white rounded-[24px] px-5 py-3 shadow-lg":""}`,children:r.role==="assistant"?e.jsxs("div",{children:[e.jsx(A,{className:"p-5",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:e.jsx("div",{className:"text-gray-800 dark:text-gray-200 leading-relaxed whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:r.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br/>")}})})}),(()=>{const p=We(r.content);return p.length>0?e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:p.map((m,h)=>{const f=`${m.activity}-${m.durationMin}`,y=T.has(f),j=Z===f;return e.jsxs("button",{onClick:()=>te(m),disabled:y||j,className:`flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-xl transition-all active:scale-95 ${y?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 cursor-default":"bg-royal-100 dark:bg-royal-900/30 text-royal-700 dark:text-royal-400 hover:bg-royal-200 dark:hover:bg-royal-900/50"}`,children:[j?e.jsx(M,{size:16,className:"animate-spin"}):y?e.jsx(fe,{size:16}):e.jsx(be,{size:16}),e.jsx("span",{children:y?"Added!":`Add ${m.title}`})]},h)})}):null})(),$e(r.content)&&e.jsxs("button",{onClick:()=>{_(r.content),W(!0)},className:"mt-3 flex items-center gap-2 px-4 py-2 bg-royal-600 hover:bg-royal-700 text-white text-sm font-semibold rounded-xl transition-all shadow-lg shadow-royal-200 dark:shadow-royal-900/40 active:scale-95",children:[e.jsx(H,{size:16}),e.jsx("span",{children:"Save as Workout Plan"})]})]}):e.jsx("p",{className:"text-sm font-medium leading-relaxed",children:r.content})})},r.id)),s.length===1&&s[0].role==="assistant"&&!o&&e.jsx("div",{className:"grid grid-cols-1 gap-3 mt-4 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-300",children:[{title:"Analyze Nutrition",desc:"Get insights on your recent eating habits",icon:"ðŸ“Š",text:"Analyze my recent nutrition",color:"from-blue-500/30 to-royal-500/30",baseBg:"bg-blue-50/40 dark:bg-blue-900/10",iconBg:"bg-blue-100 dark:bg-blue-900/40",iconBorder:"border-blue-200 dark:border-blue-700/50"},{title:"Workout Plan",desc:"Create a personalized fitness routine",icon:"ðŸ’ª",text:"Create a workout plan for me",color:"from-royal-500/30 to-indigo-500/30",baseBg:"bg-royal-50/40 dark:bg-royal-950/20",iconBg:"bg-royal-100 dark:bg-royal-950/40",iconBorder:"border-royal-200 dark:border-royal-700/50"},{title:"Calculate TDEE",desc:"Find out your daily energy expenditure",icon:"ðŸ”¥",text:"Calculate my TDEE",color:"from-orange-500/30 to-royal-500/30",baseBg:"bg-orange-50/40 dark:bg-orange-900/10",iconBg:"bg-orange-100 dark:bg-orange-900/40",iconBorder:"border-orange-200 dark:border-orange-700/50"},{title:"Macro Targets",desc:"Set optimal protein, carb, and fat goals",icon:"ðŸŽ¯",text:"Help me set macro targets",color:"from-violet-500/30 to-fuchsia-500/30",baseBg:"bg-violet-50/40 dark:bg-violet-900/10",iconBg:"bg-violet-100 dark:bg-violet-900/40",iconBorder:"border-violet-200 dark:border-violet-700/50"}].map((r,p)=>e.jsxs("button",{onClick:()=>{(async h=>{if(o)return;const f={id:crypto.randomUUID(),role:"user",content:h,timestamp:Date.now()};a(y=>[...y,f]),i(!0),S(f).catch(y=>console.error("Failed to save user message:",y));try{const y=await I(h,s),j={id:crypto.randomUUID(),role:"assistant",content:y,timestamp:Date.now()};a(b=>[...b,j]),S(j).catch(b=>console.error("Failed to save assistant message:",b))}catch(y){const j={id:crypto.randomUUID(),role:"assistant",content:`âš ï¸ ${y.message||"Failed to get response."}`,timestamp:Date.now()};a(b=>[...b,j])}finally{i(!1)}})(r.text)},className:`flex items-center gap-4 p-4 ${r.baseBg} border-2 border-gray-100 dark:border-white/10 rounded-2xl hover:border-royal-500 dark:hover:border-royal-400 hover:shadow-xl hover:shadow-royal-500/10 transition-all text-left group active:scale-[0.98] relative overflow-hidden`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${r.color} opacity-0 group-hover:opacity-100 transition-opacity`}),e.jsx("div",{className:`relative z-10 w-12 h-12 ${r.iconBg} ${r.iconBorder} border rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform shadow-sm group-hover:shadow-md`,children:r.icon}),e.jsxs("div",{className:"relative z-10 flex-1",children:[e.jsx("h3",{className:"font-extrabold text-gray-900 dark:text-gray-50 text-sm tracking-tight",children:r.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-0.5 font-semibold opacity-80",children:r.desc})]}),e.jsx("div",{className:"relative z-10 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-white/10 group-hover:bg-royal-500 group-hover:text-white transition-all shadow-sm",children:e.jsx(F,{size:16,className:"text-gray-400 dark:text-gray-500 group-hover:text-white group-hover:translate-x-0.5 transition-all"})})]},p))}),o&&e.jsx("div",{className:"flex justify-start animate-in fade-in duration-300",children:e.jsx(A,{className:"p-5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400",children:[e.jsx(M,{size:16,className:"animate-spin"}),e.jsx("span",{className:"text-sm",children:"Coach is thinking..."})]})})}),e.jsx("div",{ref:z})]}),s.length>1&&!o&&e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4 px-1 no-scrollbar animate-in fade-in slide-in-from-bottom-2 duration-500",children:[{title:"Analyze Nutrition",icon:"ðŸ“Š",text:"Analyze my recent nutrition",color:"from-blue-500/30 to-royal-500/30",baseBg:"bg-blue-50/40 dark:bg-blue-900/10",iconBg:"bg-blue-100 dark:bg-blue-900/40",iconBorder:"border-blue-200 dark:border-blue-700/50"},{title:"Workout Plan",icon:"ðŸ’ª",text:"Create a workout plan for me",color:"from-royal-500/30 to-indigo-500/30",baseBg:"bg-royal-50/40 dark:bg-royal-950/20",iconBg:"bg-royal-100 dark:bg-royal-950/40",iconBorder:"border-royal-200 dark:border-royal-700/50"},{title:"Calculate TDEE",icon:"ðŸ”¥",text:"Calculate my TDEE",color:"from-orange-500/30 to-royal-500/30",baseBg:"bg-orange-50/40 dark:bg-orange-900/10",iconBg:"bg-orange-100 dark:bg-orange-900/40",iconBorder:"border-orange-200 dark:border-orange-700/50"},{title:"Macro Targets",icon:"ðŸŽ¯",text:"Help me set macro targets",color:"from-violet-500/30 to-fuchsia-500/30",baseBg:"bg-violet-50/40 dark:bg-violet-900/10",iconBg:"bg-violet-100 dark:bg-violet-900/40",iconBorder:"border-violet-200 dark:border-violet-700/50"}].map((r,p)=>e.jsxs("button",{onClick:()=>{(async h=>{if(o)return;const f={id:`user-${Date.now()}`,role:"user",content:h,timestamp:Date.now()};a(y=>[...y,f]),i(!0),S(f).catch(y=>console.error("Failed to save user message:",y));try{const y=await I(h,s),j={id:crypto.randomUUID(),role:"assistant",content:y,timestamp:Date.now()};a(b=>[...b,j]),S(j).catch(b=>console.error("Failed to save assistant message:",b))}catch(y){const j={id:`error-${Date.now()}`,role:"assistant",content:`âš ï¸ ${y.message||"Failed to get response."}`,timestamp:Date.now()};a(b=>[...b,j])}finally{i(!1)}})(r.text)},className:`flex flex-shrink-0 items-center gap-3 p-3 min-w-[180px] ${r.baseBg} border-2 border-gray-100 dark:border-white/10 rounded-2xl hover:border-royal-500 dark:hover:border-royal-400 transition-all text-left group active:scale-[0.98] relative overflow-hidden`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${r.color} opacity-0 group-hover:opacity-100 transition-opacity`}),e.jsx("div",{className:`relative z-10 w-10 h-10 ${r.iconBg} ${r.iconBorder} border rounded-xl flex items-center justify-center text-xl group-hover:scale-110 transition-transform shadow-sm`,children:r.icon}),e.jsx("div",{className:"relative z-10 flex-1",children:e.jsx("h3",{className:"font-extrabold text-gray-900 dark:text-gray-50 text-xs tracking-tight leading-tight",children:r.title})})]},p))}),e.jsx("div",{className:"flex-shrink-0 bg-white dark:bg-[#1a1c26] rounded-[24px] p-3 shadow-diffused dark:shadow-diffused-dark border border-gray-100 dark:border-white/5",children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("textarea",{ref:B,value:n,onChange:r=>l(r.target.value),onKeyDown:X,placeholder:"Ask your coach anything...",className:"flex-1 bg-transparent text-gray-900 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500 resize-none outline-none text-sm min-h-[40px] max-h-[120px] py-2 px-3",rows:1,disabled:o}),e.jsx("button",{onClick:E,disabled:!n.trim()||o,className:"flex-shrink-0 w-10 h-10 bg-royal-600 text-white rounded-[16px] flex items-center justify-center hover:bg-royal-700 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-royal-200 dark:shadow-royal-900/40",children:o?e.jsx(M,{size:18,className:"animate-spin"}):e.jsx(we,{size:18})})]})}),e.jsx(Le,{isOpen:Y,onClose:()=>W(!1),workoutText:V})]})};export{Oe as CalCoach};
