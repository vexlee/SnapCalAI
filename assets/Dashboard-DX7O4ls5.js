import{c as ee,j as e,B as P,A as oe,g as re,s as ce,a as de,U as se,b as me,d as xe,e as he,S as ue,f as pe,h as fe}from"./index-aBxdPfl4.js";import{r}from"./vendor-react-wGySg1uH.js";import{C as be}from"./Card-DG80Tg_-.js";import{S as ge,v as ye,g as we,s as je,A as E,P as ve,U as Ne,a as ke,M as Se,b as Ce,p as ze}from"./MealDetailModal-BK-5QKdv.js";import{X as Z}from"./x-B7XsDWmg.js";import{T as L,G as Ee}from"./index-cQ6qJtkF.js";import{C as Ae}from"./camera-CHyCrURM.js";import{C as Me}from"./chevron-down-Cs0u80uX.js";import{F as Le}from"./flame-CU3srcce.js";import{P as Te}from"./plus-DKK0g_Gk.js";import"./vendor-charts-Bdt_fL2G.js";import"./vendor-supabase-DfwcnzK-.js";import"./chevron-left-BjI3rhyl.js";import"./users-9ls_ElOM.js";import"./calendar-CBjl7dX7.js";import"./trash-2-BgG9211c.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=ee("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ee("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=ee("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Pe=({currentGoal:n,onClose:d,onSave:o})=>{const[a,m]=r.useState(n.toString()),c=()=>{const x=parseInt(a,10);!isNaN(x)&&x>0&&o(x)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-md p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-xs rounded-[32px] p-6 shadow-2xl border border-white/50 animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-extrabold text-gray-900",children:"Daily Calorie Goal"}),e.jsx("button",{onClick:d,className:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(Z,{size:18,className:"text-gray-600"})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1",children:"Target Calories"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:a,onChange:x=>m(x.target.value),className:"w-full p-5 bg-gray-50 border border-gray-100 rounded-[20px] focus:outline-none focus:ring-2 focus:ring-primary-200 focus:border-primary-400 transition-all font-extrabold text-3xl text-center text-gray-900",autoFocus:!0}),e.jsx("span",{className:"absolute right-6 top-1/2 -translate-y-1/2 text-gray-400 text-sm font-bold",children:"kcal"})]})]}),e.jsx(P,{className:"w-full py-4 shadow-lg shadow-primary-200",onClick:c,children:"Update Goal"})]})})},Fe=()=>"AIzaSyBe0v3rn4bATheRJCE77AmY58Op-tiJJVU",Re=()=>{const n=Fe();return new Ee({apiKey:n})},$e=`You are a professional nutritionist and vision AI. Identify all food items in this shared meal image.

For each dish on the table, provide:
1. The dish name (be specific, e.g., "Grilled Chicken Breast" not just "Chicken")
2. A bounding box in [ymin, xmin, ymax, xmax] format with normalized coordinates (0-1000 scale)
3. Total calorie estimate for the ENTIRE portion visible on the table
4. Confidence score (0-1) based on how clearly you can identify the dish

IMPORTANT:
- Detect ALL distinct food items/dishes in the image
- Each dish should have its own bounding box
- Bounding boxes should tightly encompass each dish
- Calorie estimates are for the FULL portion shown, not per serving
- If the image contains no food, return an empty dishes array

Return ONLY a valid JSON object with this exact format:
{
  "dishes": [
    {
      "dish_name": "Dish name here",
      "bounding_box": [ymin, xmin, ymax, xmax],
      "estimated_total_calories": number,
      "confidence_score": 0.95
    }
  ]
}`,Ge=n=>{const d=(n==null?void 0:n.message)||String(n)||"",o=d.toLowerCase();return d.includes("429")||o.includes("quota")||o.includes("limit")||o.includes("exhausted")?"AI Limit Reached: You've sent too many requests. Please wait about 60 seconds for the quota to reset.":o.includes("api key")?"Configuration Error: Invalid API key. Please check your settings.":o.includes("network")||o.includes("fetch")?"Connection Error: Please check your internet connection and try again.":d||"An unexpected AI error occurred."};async function ne(n,d=2,o=2e3){try{return await n()}catch(a){const m=(a==null?void 0:a.message)||"";if((m.includes("429")||m.toLowerCase().includes("quota"))&&d>0)return console.warn(`Gemini Quota hit. Retrying in ${o}ms... (${d} retries left)`),await new Promise(x=>setTimeout(x,o)),ne(n,d-1,o*2);throw a}}const ae=async n=>{try{return await ne(async()=>{const o=await Re().models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:n}},{text:"Analyze this shared meal image and identify all dishes with their locations and calorie estimates."}]},config:{systemInstruction:$e,responseMimeType:"application/json",responseSchema:{type:L.OBJECT,properties:{dishes:{type:L.ARRAY,items:{type:L.OBJECT,properties:{dish_name:{type:L.STRING},bounding_box:{type:L.ARRAY,items:{type:L.INTEGER}},estimated_total_calories:{type:L.INTEGER},confidence_score:{type:L.NUMBER}},required:["dish_name","bounding_box","estimated_total_calories","confidence_score"]}}},required:["dishes"]},temperature:.4,topP:.95}}),a=JSON.parse(o.text||"{}");if(!a.dishes||!Array.isArray(a.dishes))throw new Error("Invalid response format from AI");if(a.dishes.forEach((m,c)=>{if(!Array.isArray(m.bounding_box)||m.bounding_box.length!==4)throw new Error(`Invalid bounding box format for dish ${c+1}`);m.bounding_box=m.bounding_box.map(x=>Math.max(0,Math.min(1e3,x)))}),a.dishes.length===0)throw new Error("No dishes detected in this image. Please ensure the photo clearly shows food items on a table.");return a})}catch(d){throw console.error("Gemini Shared Meal Analysis Error:",d),new Error(Ge(d))}},Be=(n,d=600,o=150)=>new Promise((a,m)=>{const c=new FileReader;c.readAsDataURL(n),c.onload=x=>{var A;const h=new Image;h.src=(A=x.target)==null?void 0:A.result,h.onload=()=>{const i=document.createElement("canvas");let u=h.width,f=h.height;u>d&&(f=d/u*f,u=d),i.width=u,i.height=f;const j=i.getContext("2d");j==null||j.drawImage(h,0,0,u,f);let b=.5,v=i.toDataURL("image/jpeg",b);const T=o*1024;v.split(",")[1].length*3/4>T&&(b=.35,v=i.toDataURL("image/jpeg",b),v.split(",")[1].length*3/4>T&&(b=.25,v=i.toDataURL("image/jpeg",b))),a(v)},h.onerror=i=>m(i)},c.onerror=x=>m(x)}),Ue=({onClose:n,onSuccess:d,initialImage:o})=>{const[a,m]=r.useState(o?"analyzing":"upload"),[c,x]=r.useState(o||null),[h,A]=r.useState([]),[i,u]=r.useState(new Map),[f,j]=r.useState(null),[b,v]=r.useState(50),[T,C]=r.useState(null),[F,N]=r.useState(!1),_=r.useRef(null),S=r.useRef(null),[te,I]=r.useState({width:0,height:0}),q=async t=>{if(t.target.files&&t.target.files[0]){const l=t.target.files[0];try{const p=await Be(l,600,150);x(p),C(null)}catch{C("Failed to process image.")}}};r.useEffect(()=>{o&&a==="analyzing"&&(async()=>{try{const l=o.split(",")[1],p=await ae(l);A(p.dishes),m("selection")}catch(l){C(l.message),m("upload")}})()},[o]);const H=async()=>{if(c){m("analyzing"),C(null);try{const t=c.split(",")[1],l=await ae(t);A(l.dishes),m("selection")}catch(t){C(t.message),m("upload")}}};r.useEffect(()=>{if(S.current&&a==="selection"){const t=()=>{S.current&&I({width:S.current.offsetWidth,height:S.current.offsetHeight})};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)}},[a]);const J=t=>{if(!S.current)return{x:0,y:0};const l=S.current,p=l.offsetWidth,w=l.offsetHeight,G=l.naturalWidth,D=l.naturalHeight,k=(t[1]+t[3])/2,B=(t[0]+t[2])/2,U=k/1e3,X=B/1e3,W=G/D,V=p/w;let s=p,g=w,y=0,O=0;return W>V?(g=p/W,O=(w-g)/2):(s=w*W,y=(p-s)/2),{x:U*s+y,y:X*g+O}},Y=t=>{j(t),v(i.get(t)||50)},R=()=>{if(f!==null){const t=new Map(i);b>0?t.set(f,b):t.delete(f),u(t),j(null)}},K=()=>{let t=0;return i.forEach((l,p)=>{const w=h[p];t+=Math.round(w.estimated_total_calories*l/100)}),t},$=async()=>{if(i.size===0){C("Please select at least one dish portion.");return}N(!0),C(null);try{const t=new Date,l=t.toISOString(),p=re(),w=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;for(const[G,D]of Array.from(i.entries())){const k=h[G],B=Math.round(k.estimated_total_calories*D/100),U={id:ye(),timestamp:l,date:p,time:w,food_item:`${k.dish_name} (Shared Meal - ${D}%)`,calories:B,protein:0,carbs:0,fat:0,confidence:k.confidence_score,imageUrl:c||void 0,isManual:!1};await ce(U)}d()}catch(t){console.error("Save failed:",t),C(t.message||"Failed to save entries.")}finally{N(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/40 backdrop-blur-md p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white[#1a1c26] w-full max-w-md rounded-[40px] p-6 shadow-2xl border border-white/50 animate-in slide-in-from-bottom duration-300 max-h-[95vh] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 tracking-tight",children:a==="upload"?"Shared Meal":a==="analyzing"?"Analyzing...":a==="selection"?"Select Portions":"Confirm"}),e.jsx("button",{onClick:n,className:"p-2 bg-gray-100 rounded-full hover:bg-gray-200:bg-white/10 transition-colors",children:e.jsx(Z,{size:20,className:"text-gray-600"})})]}),T&&e.jsxs("div",{className:"mb-4 p-4 rounded-3xl flex items-start gap-3 bg-red-50 border border-red-100 text-red-600 animate-in shake-1 duration-300",children:[e.jsx(oe,{className:"shrink-0 mt-0.5",size:18}),e.jsx("p",{className:"text-xs font-semibold leading-relaxed",children:T})]}),a==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary-50 p-5 rounded-4xl border border-primary-100",children:[e.jsx("p",{className:"text-xs font-bold text-primary-600 mb-2",children:"ðŸ“¸ Shared Meal Mode"}),e.jsx("p",{className:"text-xs text-slate-600 leading-relaxed",children:"Take a photo of a table with multiple dishes. The AI will identify each dish and let you specify what percentage you ate."})]}),c?e.jsxs("div",{className:"rounded-[32px] overflow-hidden h-64 relative mb-6 shadow-xl border border-white/10",children:[e.jsx("img",{src:c,className:"w-full h-full object-cover",alt:"preview"}),e.jsx("button",{onClick:()=>x(null),className:"absolute top-4 right-4 bg-black/40 text-white p-2 rounded-full backdrop-blur-md",children:e.jsx(Z,{size:20})})]}):e.jsxs("div",{onClick:()=>{var t;return(t=_.current)==null?void 0:t.click()},className:"border-2 border-dashed border-slate-200 rounded-4xl h-64 flex flex-col items-center justify-center cursor-pointer hover:border-primary-400 hover:bg-primary-50:bg-white/5 transition-all group",children:[e.jsx(Ae,{size:48,className:"text-slate-300 group-hover:text-primary-600 mb-4 transition-colors"}),e.jsx("p",{className:"text-primary-900 font-bold",children:"Snap or Upload Photo"}),e.jsx("p",{className:"text-slate-400 text-xs mt-1 italic",children:"Capture the whole table"})]}),e.jsx("input",{type:"file",ref:_,accept:"image/*",onChange:q,className:"hidden"}),e.jsx(P,{className:"w-full py-5 text-lg font-black",disabled:!c,onClick:H,children:"Detect Dishes"})]}),a==="analyzing"&&e.jsx(ge,{isActive:!0,message:"Analyzing Shared Meal..."}),a==="selection"&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative rounded-[32px] overflow-hidden border border-white/10 shadow-xl",children:[e.jsx("img",{ref:S,src:c,className:"w-full h-auto object-contain max-h-[400px]",alt:"Shared meal",onLoad:()=>{S.current&&I({width:S.current.offsetWidth,height:S.current.offsetHeight})}}),h.map((t,l)=>{const p=J(t.bounding_box),w=i.has(l);return e.jsx("button",{onClick:()=>Y(l),className:`absolute w-10 h-10 rounded-full flex items-center justify-center transition-all transform -translate-x-1/2 -translate-y-1/2 ${w?"bg-accent-500 shadow-lg shadow-accent-500/50 scale-110":"bg-primary-600 shadow-lg shadow-primary-600/50 hover:scale-110"}`,style:{left:`${p.x}px`,top:`${p.y}px`},children:w?e.jsx(Ie,{size:20,className:"text-white"}):e.jsx("span",{className:"text-white text-xs font-black",children:l+1})},l)})]}),e.jsxs("div",{className:"bg-slate-50 rounded-4xl p-5 border border-slate-100",children:[e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3",children:["Detected Dishes (",h.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto no-scrollbar",children:h.map((t,l)=>e.jsxs("button",{onClick:()=>Y(l),className:`w-full flex items-center justify-between p-3 rounded-xl transition-all ${i.has(l)?"bg-primary-50 border border-primary-200":"bg-white border border-slate-100 hover:border-primary-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-primary-600 text-white text-xs font-black flex items-center justify-center",children:l+1}),e.jsx("span",{className:"text-sm font-bold text-primary-900 truncate",children:t.dish_name})]}),i.has(l)&&e.jsxs("span",{className:"text-xs font-black text-primary-600",children:[i.get(l),"%"]})]},l))})]}),i.size>0&&e.jsxs(P,{className:"w-full py-5 text-lg font-black",onClick:()=>m("confirmation"),children:["Review Selection (",i.size," ",i.size===1?"dish":"dishes",")"]})]}),a==="confirmation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary-600 rounded-4xl p-6 text-white shadow-soft-lg",children:[e.jsx("p",{className:"text-primary-100 text-[10px] font-black uppercase tracking-widest mb-1",children:"Total Calories"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-5xl font-black tracking-tighter",children:K()}),e.jsx("span",{className:"text-xl font-bold opacity-70",children:"kcal"})]}),e.jsxs("p",{className:"text-xs text-white/70 mt-2",children:["From ",i.size," portion",i.size!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3",children:Array.from(i.entries()).map(([t,l])=>{const p=h[t],w=Math.round(p.estimated_total_calories*l/100);return e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-4 border border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-primary-900 text-sm",children:p.dish_name}),e.jsxs("span",{className:"text-xs font-black text-primary-600",children:[l,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:["Portion of ",p.estimated_total_calories," kcal"]}),e.jsxs("span",{className:"font-extrabold text-primary-900",children:[w," kcal"]})]})]},t)})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{variant:"ghost",className:"flex-1 py-4",onClick:()=>m("selection"),children:"Edit"}),e.jsx(P,{className:"flex-1 py-4 text-lg font-black",onClick:$,isLoading:F,disabled:F,children:"Save All"})]})]}),f!==null&&a==="selection"&&e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-[110] bg-white[#1a1c26] rounded-t-[40px] p-6 shadow-2xl border-t border-white/50 animate-in slide-in-from-bottom duration-300",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-black text-gray-900",children:h[f].dish_name}),e.jsx("button",{onClick:()=>j(null),className:"p-2 bg-gray-100 rounded-full",children:e.jsx(Me,{size:20,className:"text-gray-600"})})]}),e.jsxs("div",{className:"bg-primary-50 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-primary-600 uppercase flex items-center gap-1",children:[e.jsx(_e,{size:14})," Your Portion"]}),e.jsxs("span",{className:"text-2xl font-black text-primary-600",children:[b,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:b,onChange:t=>v(Number(t.target.value)),className:"w-full h-2 bg-primary-200 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6 [&::-webkit-slider-thumb]:bg-primary-600 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Your Calories"}),e.jsxs("span",{className:"text-xl font-black text-primary-900",children:[Math.round(h[f].estimated_total_calories*b/100)," kcal"]})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 mt-1",children:["Total dish: ",h[f].estimated_total_calories," kcal"]})]}),e.jsx(P,{className:"w-full py-4 text-lg font-black",onClick:R,children:"Confirm Selection"})]})})]})})},We={sm:{container:"w-10 h-10",face:"w-8 h-8",fontSize:"text-lg"},md:{container:"w-14 h-14",face:"w-11 h-11",fontSize:"text-2xl"},lg:{container:"w-20 h-20",face:"w-16 h-16",fontSize:"text-4xl"}},Oe={[E.OPTIMAL]:{bgGradient:"from-emerald-400 to-green-500",shadow:"shadow-emerald-200",ring:"ring-emerald-300",pulse:!1},[E.WARNING]:{bgGradient:"from-amber-400 to-orange-500",shadow:"shadow-amber-200",ring:"ring-amber-300",pulse:!0},[E.CRITICAL]:{bgGradient:"from-red-400 to-rose-600",shadow:"shadow-red-200",ring:"ring-red-300",pulse:!0}},Ye=({size:n="md",showStatus:d=!1,onClick:o})=>{const[a,m]=r.useState(null),[c,x]=r.useState(!1),[h,A]=r.useState(!0),i=r.useCallback(async()=>{try{const b=await we();m(b)}catch(b){console.error("Failed to load avatar status:",b)}finally{A(!1)}},[]);r.useEffect(()=>{i();const b=je(()=>{i()}),v=()=>{x(!0),setTimeout(()=>x(!1),800)};return window.addEventListener("avatar-feed",v),()=>{b(),window.removeEventListener("avatar-feed",v)}},[i]);const u=We[n],f=(a==null?void 0:a.state)||E.WARNING,j=Oe[f];return h?e.jsx("div",{className:`${u.container} rounded-full bg-gray-200 animate-pulse`}):e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("button",{onClick:o,className:`
          ${u.container} 
          relative rounded-full 
          bg-gradient-to-br ${j.bgGradient}
          shadow-lg ${j.shadow}
          flex items-center justify-center
          transition-all duration-500 ease-out
          hover:scale-110 active:scale-95
          ${j.pulse?"animate-pulse":""}
          ${c?"animate-bounce scale-125":""}
          ${o?"cursor-pointer":"cursor-default"}
        `,disabled:!o,type:"button",children:[e.jsx("div",{className:"absolute inset-1 bg-white/20 rounded-full blur-sm"}),e.jsx("div",{className:`${u.face} relative z-10 flex items-center justify-center`,children:e.jsx(Qe,{state:f,fontSize:u.fontSize,isFeeding:c})}),c&&e.jsx(qe,{})]}),e.jsx("div",{className:`
        absolute -bottom-0.5 -right-0.5
        w-3 h-3 rounded-full
        border-2 border-white[#0c0e17]
        ${f===E.OPTIMAL?"bg-emerald-500":f===E.WARNING?"bg-amber-500":"bg-red-500"}
        ${j.pulse?"animate-ping":""}
      `}),d&&a&&e.jsx("div",{className:`absolute top-full left-1/2 -translate-x-1/2 mt-2 
          bg-white[#1a1c26] rounded-xl px-3 py-2 
          shadow-lg border border-gray-100
          whitespace-nowrap z-50
          animate-in fade-in slide-in-from-top-2 duration-300
        `,children:e.jsx("p",{className:"text-xs font-medium text-gray-600",children:a.stateReason})})]})},Qe=({state:n,fontSize:d,isFeeding:o})=>e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"#FFE4C4"}),e.jsx("circle",{cx:"25",cy:"55",r:"8",fill:"#FFB6C1",opacity:"0.5"}),e.jsx("circle",{cx:"75",cy:"55",r:"8",fill:"#FFB6C1",opacity:"0.5"}),n===E.OPTIMAL?e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M30 42 Q35 38 40 42",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:"M60 42 Q65 38 70 42",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"})]}):n===E.WARNING?e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"35",cy:"42",rx:"6",ry:"7",fill:"#333"}),e.jsx("ellipse",{cx:"65",cy:"42",rx:"6",ry:"7",fill:"#333"}),e.jsx("circle",{cx:"37",cy:"40",r:"2",fill:"white"}),e.jsx("circle",{cx:"67",cy:"40",r:"2",fill:"white"}),e.jsx("path",{d:"M78 35 Q80 40 78 45 Q76 40 78 35",fill:"#87CEEB"})]}):e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"35",cy:"45",rx:"6",ry:"4",fill:"#333"}),e.jsx("ellipse",{cx:"65",cy:"45",rx:"6",ry:"4",fill:"#333"}),e.jsx("path",{d:"M28 38 L42 42",stroke:"#333",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M72 38 L58 42",stroke:"#333",strokeWidth:"2",strokeLinecap:"round"})]}),n===E.OPTIMAL?e.jsx("path",{d:"M35 60 Q50 78 65 60",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}):n===E.WARNING?e.jsx("path",{d:"M35 65 Q42 62 50 65 Q58 68 65 65",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}):e.jsx("path",{d:"M38 68 Q50 60 62 68",stroke:"#333",strokeWidth:"3",fill:"none",strokeLinecap:"round"}),o&&e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"50",cy:"65",rx:"12",ry:"10",fill:"#FF6B6B"}),e.jsx("ellipse",{cx:"50",cy:"63",rx:"8",ry:"6",fill:"#1a1a1a"})]}),n===E.OPTIMAL&&e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M15 25 L17 30 L15 35 L13 30 Z",fill:"#FFD700"}),e.jsx("path",{d:"M85 20 L87 25 L85 30 L83 25 Z",fill:"#FFD700"})]})]}),qe=()=>e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-visible",children:[0,1,2,3,4,5].map(n=>e.jsx("div",{className:"absolute animate-ping",style:{left:`${50+Math.cos(n*Math.PI/3)*60}%`,top:`${50+Math.sin(n*Math.PI/3)*60}%`,animationDelay:`${n*.1}s`,animationDuration:"0.6s"},children:e.jsx("span",{className:"text-yellow-400 text-lg",children:"âœ¨"})},n))}),dt=()=>{const[n,d]=r.useState([]),[o,a]=r.useState(!1),[m,c]=r.useState(!1),[x,h]=r.useState(null),[A,i]=r.useState(null),[u,f]=r.useState(0),[j,b]=r.useState(0),[v,T]=r.useState(0),[C,F]=r.useState(0),[N,_]=r.useState(2e3),[S,te]=r.useState(0),[I,q]=r.useState(!0),[H,J]=r.useState(""),[Y,R]=r.useState(!1),[K,$]=r.useState(null),[t,l]=r.useState(0),[p,w]=r.useState(null),[G,D]=r.useState(!1),k=async()=>{try{const s=await me(),g=re(),y=s.filter(z=>z.date===g);y.sort((z,M)=>M.timestamp.localeCompare(z.timestamp)),d(y),f(y.reduce((z,M)=>z+M.calories,0)),b(y.reduce((z,M)=>z+(M.protein||0),0)),T(y.reduce((z,M)=>z+(M.carbs||0),0)),F(y.reduce((z,M)=>z+(M.fat||0),0));const O=await xe();_(O);const Q=await he();Q!=null&&Q.name&&J(Q.name);const ie=await Ce();l(ie.currentStreak);const le=await ze();w(le)}catch(s){console.error("Failed to load dashboard data",s)}finally{q(!1)}};r.useEffect(()=>{k();const s=()=>k();window.addEventListener("food-entry-updated",s);const g=()=>k();window.addEventListener("streak-updated",g);const y=()=>{console.log("ðŸ“Š Dashboard: Midnight detected, reloading data..."),k()};return window.addEventListener("midnight-refresh",y),()=>{window.removeEventListener("food-entry-updated",s),window.removeEventListener("streak-updated",g),window.removeEventListener("midnight-refresh",y)}},[]),r.useEffect(()=>{if(I)return;const s=Math.min(u/N*100,100),g=setTimeout(()=>{te(s)},100);return()=>clearTimeout(g)},[u,N,I]);const B=async s=>{await fe(s),await k()},U=s=>{h(null),i(s),a(!0)},X=async s=>{await pe(s),_(s),c(!1)},W=()=>{const s=u/N*100;if(s>=100)return{background:"repeating-linear-gradient(45deg, #facc15, #facc15 12px, #171717 12px, #171717 24px)",boxShadow:"0 0 12px rgba(250, 204, 21, 0.4)"};if(s<=60)return{background:"#10b981",boxShadow:"0 0 12px rgba(16, 185, 129, 0.4)"};if(s<=80)return{background:`linear-gradient(90deg, #10b981 0%, #10b981 ${60/s*100}%, #facc15 100%)`,boxShadow:"0 0 12px rgba(250, 204, 21, 0.3)"};const g=60/s*100,y=80/s*100;return{background:`linear-gradient(90deg, #10b981 0%, #10b981 ${g}%, #facc15 ${y}%, #f97316 100%)`,boxShadow:"0 0 12px rgba(249, 115, 22, 0.3)"}},V=s=>{if(s.isManual)return s.imageUrl?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-amber-50 text-amber-600 text-[10px] font-bold tracking-wide",children:[e.jsx(De,{size:10}),"EDITED"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gray-100 text-gray-500 text-[10px] font-bold tracking-wide",children:[e.jsx(se,{size:10}),"MANUAL"]});const g=Math.round(s.confidence*100),y=g>80?"bg-emerald-50 text-emerald-600":g>50?"bg-orange-50 text-orange-600":"bg-rose-50 text-rose-600";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-[10px] font-bold tracking-wide ${y}`,children:[e.jsx(ue,{size:10}),g,"% AI"]})};return e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 animate-in fade-in duration-500 overflow-hidden relative",children:[e.jsxs("div",{className:"flex-shrink-0 px-6 pt-6 sm:pt-10 space-y-4 sm:space-y-8 pb-4",children:[e.jsxs("header",{className:"flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-secondary-500 font-bold text-xs uppercase tracking-widest mb-2",children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}),e.jsxs("h1",{className:"text-3xl sm:text-4xl font-extrabold text-primary-900 tracking-tight leading-tight sm:leading-none font-display",children:["Hello ",H||"there",", ",e.jsx("br",{}),"Let's Eat Well."]})]}),e.jsx("div",{className:"relative",onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1),children:e.jsx(Ye,{size:"md",showStatus:G})})]}),t>0&&e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white px-3 py-1.5 rounded-full shadow-lg shadow-orange-200 animate-in slide-in-from-left duration-500 w-fit",children:[e.jsx(Le,{size:16,className:"animate-pulse"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-base font-extrabold",children:t}),e.jsx("span",{className:"text-xs font-bold text-white/90",children:"day streak!"})]}),t>=7&&t<14&&e.jsx("span",{className:"ml-2 text-[10px] bg-white/20 px-2 py-0.5 rounded-full font-medium",children:"ðŸ”¥ Keep it up!"}),t>=14&&t<30&&e.jsx("span",{className:"ml-2 text-[10px] bg-white/20 px-2 py-0.5 rounded-full font-medium",children:"ðŸš€ On fire!"}),t>=30&&e.jsx("span",{className:"ml-2 text-[10px] bg-white/20 px-2 py-0.5 rounded-full font-medium",children:"ðŸ‘‘ Legend!"})]}),(()=>{const s=u>N;return e.jsxs("div",{className:`relative rounded-[32px] p-6 sm:p-7 text-white overflow-hidden shadow-soft-lg transition-all duration-500 ${s?"bg-red-500 shadow-red-200":"bg-[#3D745B] shadow-sm shadow-primary-200/50"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-10 -mr-10 w-48 h-48 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-10 -ml-10 w-48 h-48 bg-black/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-primary-100 text-xs font-bold uppercase tracking-widest mb-1",children:"Calories Consumed"}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-5xl sm:text-6xl font-black tracking-tighter sm:leading-none",children:I?"...":u}),e.jsx("span",{className:"text-lg text-primary-200 font-medium ml-1",children:"kcal"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 text-primary-100 mb-1",children:[e.jsxs("span",{className:"text-xs font-semibold",children:["Goal: ",N]}),e.jsx("button",{onClick:()=>c(!0),className:"p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors backdrop-blur-sm",children:e.jsx(ve,{size:12})})]})})]}),e.jsx("div",{className:"w-full bg-black/10 rounded-full h-4 mb-4 overflow-hidden backdrop-blur-sm relative border border-white/5",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-1000 ease-out will-change-[width] flex items-center justify-center overflow-hidden",style:{width:`${S}%`,...W()},children:u/N>=1&&e.jsx("span",{className:"text-[10px] font-black tracking-tighter text-white drop-shadow-md animate-pulse",children:"OVER"})})}),e.jsx("div",{className:"flex justify-end mb-6",children:s?e.jsxs("div",{className:"flex items-center gap-1.5 bg-white/20 backdrop-blur-md px-3 py-1 rounded-full animate-pulse",children:[e.jsx(de,{size:14,className:"text-white",fill:"white"}),e.jsxs("span",{className:"font-bold text-xs text-white",children:[Math.abs(N-u).toLocaleString()," kcal over limit"]})]}):e.jsxs("p",{className:"text-xs font-medium text-primary-100",children:[Math.max(N-u,0).toLocaleString()," kcal remaining"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 border-t border-white/10 pt-4",children:[e.jsxs("div",{className:`flex flex-col items-center justify-center p-2 rounded-2xl border-t border-x border-b shadow-sm relative overflow-hidden group transition-colors ${s?"bg-black/30 border-emerald-500/20":"bg-primary-700/30 border-primary-500/20"}`,children:[e.jsx("p",{className:"text-[9px] uppercase font-bold mb-0.5 relative z-10 tracking-wider text-emerald-300",children:"Protein"}),e.jsxs("div",{className:"flex items-baseline gap-0.5 relative z-10",children:[e.jsx("span",{className:"text-xl font-black text-white drop-shadow-md",children:j}),e.jsx("span",{className:"text-[10px] font-bold text-emerald-200",children:"g"})]})]}),e.jsxs("div",{className:`flex flex-col items-center justify-center p-2 rounded-2xl border-t border-x border-b shadow-sm relative overflow-hidden group transition-colors ${s?"bg-black/30 border-amber-500/20":"bg-primary-700/30 border-primary-500/20"}`,children:[e.jsx("p",{className:"text-[9px] uppercase font-bold mb-0.5 relative z-10 tracking-wider text-amber-300",children:"Carbs"}),e.jsxs("div",{className:"flex items-baseline gap-0.5 relative z-10",children:[e.jsx("span",{className:"text-xl font-black text-white drop-shadow-md",children:v}),e.jsx("span",{className:"text-[10px] font-bold text-amber-200",children:"g"})]})]}),e.jsxs("div",{className:`flex flex-col items-center justify-center p-2 rounded-2xl border-t border-x border-b shadow-sm relative overflow-hidden group transition-colors ${s?"bg-black/30 border-rose-500/20":"bg-primary-700/30 border-primary-500/20"}`,children:[e.jsx("p",{className:"text-[9px] uppercase font-bold mb-0.5 relative z-10 tracking-wider text-rose-300",children:"Fat"}),e.jsxs("div",{className:"flex items-baseline gap-0.5 relative z-10",children:[e.jsx("span",{className:"text-xl font-black text-white drop-shadow-md",children:C}),e.jsx("span",{className:"text-[10px] font-bold text-rose-200",children:"g"})]})]})]})]})]})})()]}),e.jsx("div",{className:"flex-shrink-0 px-6 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h2",{className:"text-xl font-bold text-primary-900 font-display",children:"Recent Meals"}),e.jsxs("span",{className:"text-xs font-bold text-secondary-500 bg-secondary-100 px-2.5 py-1 rounded-full",children:[n.length," items"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar px-6 pb-32",children:I?e.jsx("div",{className:"space-y-4",children:[1,2].map(s=>e.jsx("div",{className:"h-24 bg-surface rounded-4xl animate-pulse shadow-sm border border-white/40"},s))}):n.length===0?e.jsxs("div",{className:"text-center py-16 bg-surface rounded-4xl border border-white/40 shadow-soft",children:[e.jsx("div",{className:"w-16 h-16 bg-secondary-50 rounded-full flex items-center justify-center mx-auto mb-4 text-secondary-300",children:e.jsx(Ne,{size:24})}),e.jsx("p",{className:"text-secondary-500 font-medium mb-1",children:"No meals tracked today."}),e.jsx("p",{className:"text-xs text-secondary-400",children:"Tap the + button to add one."})]}):e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsxs(be,{className:"flex gap-4 items-center p-4 group",onClick:()=>h(s),children:[e.jsx("div",{className:"w-16 h-16 bg-secondary-50 rounded-3xl overflow-hidden flex-shrink-0 shadow-inner",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.food_item,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-secondary-300",children:e.jsx(se,{size:20})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h3",{className:"font-bold text-primary-900 truncate text-base",children:s.food_item})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-semibold text-secondary-400",children:s.time}),V(s)]})]}),e.jsxs("div",{className:"text-right pl-2",children:[e.jsx("span",{className:"block font-black text-primary-900 text-xl",children:s.calories}),e.jsx("span",{className:"text-[10px] font-bold text-secondary-400 uppercase tracking-wider",children:"kcal"})]})]},s.id))})}),e.jsx("button",{onClick:()=>{i(null),a(!0)},className:"absolute bottom-28 right-6 w-16 h-16 bg-[#3D745B] text-white rounded-full shadow-[0_12px_24px_-6px_rgba(45,74,62,0.5)] flex items-center justify-center hover:scale-105 hover:bg-primary-700 active:scale-95 transition-all z-[60]",children:e.jsx(Te,{size:32,strokeWidth:2.5})}),o&&e.jsx(ke,{editEntry:A,onClose:()=>{a(!1),i(null)},onSuccess:()=>{a(!1),i(null),k()},onOpenSharedMeal:s=>{a(!1),i(null),s&&$(s),setTimeout(()=>R(!0),100)}}),m&&e.jsx(Pe,{currentGoal:N,onClose:()=>c(!1),onSave:X}),x&&e.jsx(Se,{entry:x,onClose:()=>h(null),onDelete:B,onEdit:U}),Y&&e.jsx(Ue,{initialImage:K,onClose:()=>{R(!1),$(null)},onSuccess:()=>{R(!1),$(null),k()}})]})};export{dt as Dashboard};
