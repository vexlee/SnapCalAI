const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Dashboard-DAO6s525.js","./vendor-react-wGySg1uH.js","./Card-DmvV4Kle.js","./vendor-charts-Bdt_fL2G.js","./MealDetailModal-C63OUF37.js","./index-cQ6qJtkF.js","./chevron-left-xlMyuGyN.js","./x-cPY8tAPm.js","./users-DF2BtIrB.js","./camera-FoIB3EOb.js","./calendar-DHSjsTmI.js","./trash-2-Qc_CcC2q.js","./chevron-down-D11qf3k4.js","./flame-bcWGHNt1.js","./plus-C12polZs.js","./vendor-supabase-DfwcnzK-.js","./CalCoach-xMCRc9I7.js","./workoutTypes-CLcPtimd.js","./loader-2-DO87uK3l.js","./check-BedwUYcb.js","./WorkoutPlan-DngC3bIC.js","./target-R8J5gptx.js","./heart-Bj_H_x6x.js","./chevron-right-eSSj62GG.js","./History-CeziRLgU.js","./trending-up-DSXVJ_f6.js","./scale-BMBpPC38.js","./Profile-B2GM9Mco.js","./weight-DQLW0Qry.js","./Onboarding-BjH0VKg_.js"])))=>i.map(i=>d[i]);
var de=Object.defineProperty;var ue=(e,t,a)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var N=(e,t,a)=>ue(e,typeof t!="symbol"?t+"":t,a);import{r as p,a as me,R as fe}from"./vendor-react-wGySg1uH.js";import{c as O}from"./vendor-charts-Bdt_fL2G.js";import{c as ge}from"./vendor-supabase-DfwcnzK-.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();var X={exports:{}},P={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var he=p,pe=Symbol.for("react.element"),_e=Symbol.for("react.fragment"),ye=Object.prototype.hasOwnProperty,xe=he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,be={key:!0,ref:!0,__self:!0,__source:!0};function V(e,t,a){var r,s={},o=null,n=null;a!==void 0&&(o=""+a),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(n=t.ref);for(r in t)ye.call(t,r)&&!be.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:pe,type:e,key:o,ref:n,props:s,_owner:xe.current}}P.Fragment=_e;P.jsx=V;P.jsxs=V;X.exports=P;var i=X.exports,H={},J=me;H.createRoot=J.createRoot,H.hydrateRoot=J.hydrateRoot;const we="modulepreload",Se=function(e,t){return new URL(e,t).href},G={},k=function(t,a,r){let s=Promise.resolve();if(a&&a.length>0){const n=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(a.map(c=>{if(c=Se(c,r),c in G)return;G[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!r)for(let C=n.length-1;C>=0;C--){const I=n[C];if(I.href===c&&(!u||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":we,u||(y.as="script"),y.crossOrigin="",y.href=c,d&&y.setAttribute("nonce",d),document.head.appendChild(y),u)return new Promise((C,I)=>{y.addEventListener("load",C),y.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return s.then(n=>{for(const l of n||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};var g=(e=>(e.DASHBOARD="DASHBOARD",e.CAL_COACH="CAL_COACH",e.WORKOUT_PLAN="WORKOUT_PLAN",e.HISTORY="HISTORY",e.PROFILE="PROFILE",e.ONBOARDING="ONBOARDING",e))(g||{});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ve={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),v=(e,t)=>{const a=p.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:n,className:l="",children:d,...c},u)=>p.createElement("svg",{ref:u,...ve,width:s,height:s,stroke:r,strokeWidth:n?Number(o)*24/Number(s):o,className:["lucide",`lucide-${Ee(e)}`,l].join(" "),...c},[...t.map(([h,S])=>p.createElement(h,S)),...Array.isArray(d)?d:[d]]));return a.displayName=`${e}`,a};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=v("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=v("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=v("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=v("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=v("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=v("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=v("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=v("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=v("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=v("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=v("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Pe=({children:e,currentView:t,onNavigate:a})=>i.jsxs("div",{className:"h-[100dvh] bg-gradient-to-br from-[#F9F7F2] to-[#F3F0E7] flex flex-col max-w-md mx-auto relative shadow-2xl shadow-gray-200 overflow-hidden border-x border-primary-100/50 transition-colors duration-300",children:[i.jsx("main",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:e}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-background via-background/90 to-transparent pointer-events-none z-40"}),i.jsx("div",{className:"absolute bottom-6 left-5 right-5 z-50",children:i.jsxs("nav",{className:"bg-[#3D745B] rounded-full p-2 shadow-soft-lg border border-white/10 flex justify-between items-center",children:[i.jsxs("button",{onClick:()=>a(g.DASHBOARD),className:O("flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-500",t===g.DASHBOARD?"flex-[1.6] bg-white text-[#3D745B] shadow-lg px-4":"flex-1 text-white/70 hover:text-white hover:bg-white/10"),children:[i.jsx(Ae,{size:22,strokeWidth:t===g.DASHBOARD?2.5:2}),t===g.DASHBOARD&&i.jsx("span",{className:"text-sm font-semibold animate-in fade-in slide-in-from-left-2 duration-300",children:"Today"})]}),i.jsxs("button",{onClick:()=>a(g.CAL_COACH),className:O("flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-500",t===g.CAL_COACH?"flex-[1.6] bg-white text-[#3D745B] shadow-lg px-4":"flex-1 text-white/70 hover:text-white hover:bg-white/10"),children:[i.jsx(Ie,{size:22,strokeWidth:t===g.CAL_COACH?2.5:2}),t===g.CAL_COACH&&i.jsx("span",{className:"text-sm font-semibold animate-in fade-in slide-in-from-left-2 duration-300",children:"Coach"})]}),i.jsxs("button",{onClick:()=>a(g.WORKOUT_PLAN),className:O("flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-500",t===g.WORKOUT_PLAN?"flex-[2] bg-white text-[#3D745B] shadow-lg px-4":"flex-1 text-white/70 hover:text-white hover:bg-white/10"),children:[i.jsx(Le,{size:22,strokeWidth:t===g.WORKOUT_PLAN?2.5:2}),t===g.WORKOUT_PLAN&&i.jsx("span",{className:"text-sm font-semibold animate-in fade-in slide-in-from-left-2 duration-300",children:"Workout"})]}),i.jsxs("button",{onClick:()=>a(g.HISTORY),className:O("flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-500",t===g.HISTORY?"flex-[1.6] bg-white text-[#3D745B] shadow-lg px-4":"flex-1 text-white/70 hover:text-white hover:bg-white/10"),children:[i.jsx(Ne,{size:22,strokeWidth:t===g.HISTORY?2.5:2}),t===g.HISTORY&&i.jsx("span",{className:"text-sm font-semibold animate-in fade-in slide-in-from-right-2 duration-300",children:"Report"})]}),i.jsxs("button",{onClick:()=>a(g.PROFILE),className:O("flex items-center justify-center gap-2 py-3 rounded-full transition-all duration-500",t===g.PROFILE?"flex-[1.6] bg-white text-[#3D745B] shadow-lg px-4":"flex-1 text-white/70 hover:text-white hover:bg-white/10"),children:[i.jsx(Re,{size:22,strokeWidth:t===g.PROFILE?2.5:2}),t===g.PROFILE&&i.jsx("span",{className:"text-sm font-semibold animate-in fade-in slide-in-from-right-2 duration-300",children:"Profile"})]})]})})]}),$="https://vsqytdzbxxhketbvcoif.supabase.co",ee=`sb_publishable_m-b7gwiZtZu4k0eaXHPoTg_mM_qFuvG
`;console.log("Supabase URL Detected:","Yes",`(Length: ${$.length})`);console.log("Supabase Key Detected:","Yes",`(Length: ${ee.length})`);const D=$.startsWith("http"),te="snapcal_mode_preference",Me=()=>D?localStorage.getItem(te)==="local"?"local":"cloud":"local",ht=e=>{localStorage.setItem(te,e),window.location.reload()},f=D&&Me()==="cloud";D?f||console.log("Supabase configured but user prefers Local Storage."):console.log("Supabase is not configured. Using Mock Auth & Local Storage.");const m=ge(D?$:"https://placeholder.supabase.co",D?ee:"placeholder"),M="snapcal_mock_session",R="snapcal_auth_change",Ue=e=>new Promise(t=>setTimeout(t,e)),re=async(e,t)=>{var a,r;if(f){const{data:s,error:o}=await m.auth.signInWithPassword({email:e,password:t});if(o)throw new Error(o.message);return{user:{id:((a=s.user)==null?void 0:a.id)||"",email:(r=s.user)==null?void 0:r.email}}}else{await Ue(600);const s={id:btoa(e.toLowerCase()),email:e};return localStorage.setItem(M,JSON.stringify(s)),window.dispatchEvent(new Event(R)),{user:s}}},Fe=async(e,t)=>{var a,r;if(f){const{data:s,error:o}=await m.auth.signUp({email:e,password:t});if(o)throw new Error(o.message);return{user:{id:((a=s.user)==null?void 0:a.id)||"",email:(r=s.user)==null?void 0:r.email}}}else return re(e,t)},pt=async()=>{if(f){const{error:e}=await m.auth.signOut();if(e)throw e}else localStorage.removeItem(M),window.dispatchEvent(new Event(R))},_=async()=>{if(f){const{data:e}=await m.auth.getUser();return e.user?{id:e.user.id,email:e.user.email}:null}else{const e=localStorage.getItem(M);return e?JSON.parse(e):null}},qe=e=>{if(f){const{data:t}=m.auth.onAuthStateChange((a,r)=>{r!=null&&r.user?e({id:r.user.id,email:r.user.email}):e(null)});return()=>t.subscription.unsubscribe()}else{const t=()=>{const a=localStorage.getItem(M);e(a?JSON.parse(a):null)};return window.addEventListener(R,t),window.addEventListener("storage",t),()=>{window.removeEventListener(R,t),window.removeEventListener("storage",t)}}},Be=({className:e,variant:t="primary",isLoading:a,children:r,...s})=>{const o="inline-flex items-center justify-center px-6 py-4 rounded-full font-semibold transition-all duration-300 active:scale-95 disabled:opacity-50 disabled:pointer-events-none text-sm tracking-wide",n={primary:"bg-primary-600 text-white hover:bg-primary-700 shadow-[0_10px_20px_-10px_rgba(45,74,62,0.4)]",secondary:"bg-secondary-100 text-secondary-800 hover:bg-secondary-200",ghost:"bg-transparent text-secondary-600 hover:text-primary-600 hover:bg-secondary-50"};return i.jsx("button",{className:O(o,n[t],e),disabled:a||s.disabled,...s,children:a?i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):r})},He=()=>{const[e,t]=p.useState(!0),[a,r]=p.useState(""),[s,o]=p.useState(""),[n,l]=p.useState(null),[d,c]=p.useState(!1),[u,h]=p.useState(null),S=async y=>{y.preventDefault(),l(null),h(null),c(!0);try{e?await re(a,s):(await Fe(a,s),e||(h("Account created successfully!"),t(!0)))}catch(C){console.error(C),l(C.message||"Authentication failed")}finally{c(!1)}};return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#F9F7F2] to-[#F3F0E7] flex flex-col items-center justify-center p-6 relative overflow-hidden",children:[i.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none",children:[i.jsx("div",{className:"absolute top-[-20%] right-[-20%] w-[500px] h-[500px] bg-primary-100/30 rounded-full blur-[100px]"}),i.jsx("div",{className:"absolute bottom-[-10%] left-[-10%] w-80 h-80 bg-primary-200/20 rounded-full blur-[80px]"})]}),i.jsxs("div",{className:"w-full max-w-sm z-10",children:[i.jsxs("div",{className:"text-center mb-10",children:[i.jsx("div",{className:"w-20 h-20 bg-white rounded-[24px] flex items-center justify-center mx-auto mb-6 shadow-xl shadow-primary-200/50 rotate-3 transition-transform hover:rotate-0 duration-500",children:i.jsx(Te,{size:36,className:"text-[#3D745B] fill-[#3D745B]"})}),i.jsx("h1",{className:"text-4xl font-extrabold text-gray-900 tracking-tight mb-2",children:"SnapCal AI"}),i.jsx("p",{className:"text-gray-500 font-medium",children:"Track your vibe, not just calories."})]}),i.jsxs("div",{className:"bg-white/80 backdrop-blur-xl border border-white p-8 rounded-[40px] shadow-[0_20px_40px_-12px_rgba(0,0,0,0.05)]",children:[i.jsxs("div",{className:"flex p-1 bg-[#3D745B] rounded-[20px] mb-8 shadow-sm",children:[i.jsx("button",{onClick:()=>{t(!0),l(null),h(null)},className:`flex-1 py-3 text-sm font-bold rounded-[16px] transition-all duration-300 ${e?"bg-white text-[#3D745B] shadow-lg":"text-white/70 hover:text-white"}`,children:"Sign In"}),i.jsx("button",{onClick:()=>{t(!1),l(null),h(null)},className:`flex-1 py-3 text-sm font-bold rounded-[16px] transition-all duration-300 ${e?"text-white/70 hover:text-white":"bg-white text-[#3D745B] shadow-lg"}`,children:"Sign Up"})]}),i.jsxs("form",{onSubmit:S,className:"space-y-5",children:[n&&i.jsxs("div",{className:"p-4 bg-red-50 border border-red-100 rounded-2xl flex items-center gap-3 text-red-600 text-sm font-medium animate-in fade-in slide-in-from-top-2",children:[i.jsx(Ce,{size:18}),n]}),u&&i.jsxs("div",{className:"p-4 bg-emerald-50 border border-emerald-100 rounded-2xl flex items-center gap-3 text-emerald-600 text-sm font-medium animate-in fade-in slide-in-from-top-2",children:[i.jsx(De,{size:18}),u]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1",children:"Email"}),i.jsx("input",{type:"email",required:!0,value:a,onChange:y=>r(y.target.value),className:"w-full p-4 bg-gray-50 border border-gray-100 rounded-[20px] focus:outline-none focus:ring-2 focus:ring-primary-200 focus:border-primary-400 text-gray-900 transition-all placeholder:text-gray-400 font-medium",placeholder:"hello@snapcal.ai"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 ml-1",children:"Password"}),i.jsx("input",{type:"password",required:!0,value:s,onChange:y=>o(y.target.value),className:"w-full p-4 bg-gray-50 border border-gray-100 rounded-[20px] focus:outline-none focus:ring-2 focus:ring-primary-200 focus:border-primary-400 text-gray-900 transition-all placeholder:text-gray-400 font-medium",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",minLength:6})]})]}),i.jsxs(Be,{className:"w-full mt-4 flex justify-between items-center group py-5 bg-[#3D745B] hover:bg-[#315C49] border-none shadow-lg shadow-primary-100 text-white",isLoading:d,children:[i.jsx("span",{children:e?"Sign In":"Create Account"}),!d&&i.jsx(ke,{size:20,className:"group-hover:translate-x-1 transition-transform"})]})]})]}),i.jsx("p",{className:"text-center text-gray-400 text-xs mt-8 font-medium",children:e?"New here? Create an account above.":"Welcome back. Sign in above."})]})]})};class $e{constructor(){N(this,"cache",new Map);N(this,"defaultTTL",5*60*1e3)}get(t){const a=this.cache.get(t);return a?Date.now()-a.timestamp>a.ttl?(this.cache.delete(t),null):a.data:null}set(t,a,r){this.cache.set(t,{data:a,timestamp:Date.now(),ttl:r||this.defaultTTL})}has(t){return this.get(t)!==null}invalidate(t){this.cache.delete(t)}invalidatePattern(t){const a=[];this.cache.forEach((r,s)=>{t.test(s)&&a.push(s)}),a.forEach(r=>this.cache.delete(r))}clear(){this.cache.clear()}clearDateSensitiveCaches(){console.log("ðŸ—‘ï¸ Clearing date-sensitive caches..."),this.invalidatePattern(/^food:/),console.log("âœ… Date-sensitive caches cleared")}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const b=new $e,w={ENTRIES:"food:entries",ENTRIES_LITE:"food:entries:lite",DAILY_SUMMARIES:"food:summaries",DAILY_SUMMARIES_LITE:"food:summaries:lite",DAILY_GOAL:"user:goal",USER_PROFILE:"user:profile",STREAK_DATA:"user:streak",AVATAR_STATE:"user:avatar",WEIGHT_GOAL:"user:weight-goal",entriesForDate:e=>`food:entries:${e}`,entryImage:e=>`food:image:${e}`,summariesForRange:(e,t)=>`food:summaries:${e}:${t}`};async function E(e,t,a){const r=b.get(e);if(r!==null)return r;const s=await t();return b.set(e,s,a),s}const We=()=>{const e=new Date,t=new Date(e);return t.setHours(24,0,0,0),t.getTime()-e.getTime()},Ye=e=>{let t;const a=()=>{const r=We();console.log(`â° Scheduling midnight refresh in ${Math.round(r/1e3/60)} minutes`),t=setTimeout(()=>{console.log("ðŸŒ™ Midnight detected! Running callback..."),e(),a()},r)};return a(),()=>{t&&(clearTimeout(t),console.log("â° Midnight timer canceled"))}},ae=()=>{const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`},B="snapcal_last_active_date",Ke=()=>{const e=ae(),t=localStorage.getItem(B);if(!t)return localStorage.setItem(B,e),!1;const a=t!==e;return a&&(console.log(`ðŸ“… Day changed detected: ${t} â†’ ${e}`),localStorage.setItem(B,e)),a},W="snapcal_data_v1",L="snapcal_settings_v1",A="snapcal_profile_v1",Y="snapcal_summaries_v1",se="snapcal_coach_messages_v1",oe="snapcal_workout_plans_v1",ze="id, user_id, timestamp, date, time, food_item, calories, protein, carbs, fat, confidence, image_url, is_manual, ingredients, original_ai_response",ne="id, user_id, timestamp, date, time, food_item, calories, protein, carbs, fat, confidence, is_manual, ingredients",Je="id, date, calories, protein, carbs, fat",x=()=>{try{const e=localStorage.getItem(W);return e?JSON.parse(e):[]}catch{return[]}},U=e=>{try{localStorage.setItem(W,JSON.stringify(e))}catch(t){throw t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED"||String(t).toLowerCase().includes("quota")?new Error("Browser Storage Full: Your local history (with photos) has reached the browser's 5MB limit. Please delete some old entries in the History tab or connect to Supabase for unlimited cloud storage."):t}},K=()=>{try{const e=localStorage.getItem(Y);return e?JSON.parse(e):[]}catch{return[]}},Ge=e=>{try{localStorage.setItem(Y,JSON.stringify(e))}catch{throw new Error("Browser Storage Full: Cannot even save simple summaries. Please clear your browser data.")}},F=e=>({id:e.id,user_id:e.user_id,timestamp:e.timestamp,date:e.date,time:e.time,food_item:e.food_item,calories:e.calories,protein:e.protein||0,carbs:e.carbs||0,fat:e.fat||0,confidence:e.confidence,imageUrl:e.image_url,isManual:e.is_manual,ingredients:e.ingredients||[],originalAiResponse:e.original_ai_response}),j=(e,t)=>{console.error(`Supabase ${t} Error:`,e);const a=(e==null?void 0:e.message)||String(e)||"",r=a.toLowerCase();throw r.includes("quota")||r.includes("limit")||r.includes("tier")?new Error("Cloud Quota Reached: Your Supabase storage limit has been exceeded. Try deleting old entries."):r.includes("relation")||r.includes("column")||r.includes("does not exist")?new Error("Database Setup Required: It looks like the 'food_entries' table is missing in Supabase. Please check the Profile tab for the setup SQL script."):r.includes("policy")||r.includes("permission")||r.includes("row-level security")?new Error("Permission Denied: Supabase RLS policies are blocking this save. Ensure authenticated users have 'INSERT' and 'UPDATE' access."):new Error(`Cloud Save Failed: ${a}`)},_t=async e=>{const t=await _();if(!t)throw new Error("User must be logged in to save.");if(!f){const r=x(),s=r.findIndex(n=>n.id===e.id),o={...e,user_id:t.id};s>=0?r[s]=o:r.push(o),U(r),b.invalidatePattern(/^food:/);return}const{error:a}=await m.from("food_entries").upsert({id:e.id,user_id:t.id,timestamp:e.timestamp,date:e.date,time:e.time,food_item:e.food_item,calories:e.calories,protein:e.protein,carbs:e.carbs,fat:e.fat,confidence:e.confidence,is_manual:e.isManual,image_url:e.imageUrl===void 0?null:e.imageUrl,ingredients:e.ingredients,original_ai_response:e.originalAiResponse});a&&j(a,"Save Entry"),b.invalidatePattern(/^food:/)},yt=async()=>E(w.ENTRIES,async()=>{const e=await _();if(!e)return[];if(!f)return x().filter(r=>r.user_id===e.id).sort((r,s)=>s.timestamp.localeCompare(r.timestamp));const{data:t,error:a}=await m.from("food_entries").select(ze).eq("user_id",e.id).order("timestamp",{ascending:!1}).limit(200);return a?(console.error("Supabase Fetch Error:",a),a.message.includes("relation")?[]:[]):t?t.map(F):[]},3*60*1e3),xt=async()=>E(w.ENTRIES_LITE,async()=>{const e=await _();if(!e)return[];if(!f)return x().filter(r=>r.user_id===e.id).map(r=>({...r,imageUrl:void 0,originalAiResponse:void 0})).sort((r,s)=>s.timestamp.localeCompare(r.timestamp));const{data:t,error:a}=await m.from("food_entries").select(ne).eq("user_id",e.id).order("timestamp",{ascending:!1}).limit(200);return a?(console.error("Supabase Fetch Lite Error:",a),[]):t?t.map(F):[]},3*60*1e3),bt=async()=>E(w.DAILY_SUMMARIES_LITE,async()=>{const e=await _();if(!e)return[];if(!f){const s=x().filter(d=>d.user_id===e.id),o={};s.forEach(d=>{o[d.date]||(o[d.date]=[]),o[d.date].push(d)});const n=K().filter(d=>d.user_id===e.id),l={};return n.forEach(d=>{l[d.date]={date:d.date,totalCalories:d.total_calories||d.totalCalories,totalProtein:d.total_protein||d.totalProtein||0,totalCarbs:d.total_carbs||d.totalCarbs||0,totalFat:d.total_fat||d.totalFat||0}}),Object.keys(o).forEach(d=>{const c=o[d];l[d]={date:d,totalCalories:c.reduce((u,h)=>u+h.calories,0),totalProtein:c.reduce((u,h)=>u+(h.protein||0),0),totalCarbs:c.reduce((u,h)=>u+(h.carbs||0),0),totalFat:c.reduce((u,h)=>u+(h.fat||0),0)}}),Object.values(l).sort((d,c)=>new Date(c.date).getTime()-new Date(d.date).getTime())}const{data:t,error:a}=await m.from("food_entries").select("date, calories, protein, carbs, fat").eq("user_id",e.id).order("date",{ascending:!1});if(a)return console.error("Supabase summary fetch error:",a),[];const r={};(t||[]).forEach(s=>{r[s.date]||(r[s.date]={calories:0,protein:0,carbs:0,fat:0}),r[s.date].calories+=s.calories||0,r[s.date].protein+=s.protein||0,r[s.date].carbs+=s.carbs||0,r[s.date].fat+=s.fat||0});try{const{data:s}=await m.from("daily_summaries").select("date, total_calories, total_protein, total_carbs, total_fat").eq("user_id",e.id);(s||[]).forEach(o=>{r[o.date]||(r[o.date]={calories:o.total_calories,protein:o.total_protein,carbs:o.total_carbs,fat:o.total_fat})})}catch{}return Object.entries(r).map(([s,o])=>({date:s,totalCalories:o.calories,totalProtein:o.protein,totalCarbs:o.carbs,totalFat:o.fat})).sort((s,o)=>new Date(o.date).getTime()-new Date(s.date).getTime())},3*60*1e3),wt=async(e,t)=>E(w.summariesForRange(e,t),async()=>{const a=await _();if(!a)return[];if(!f){const n=x().filter(c=>c.user_id===a.id&&c.date>=e&&c.date<=t),l={};return n.forEach(c=>{l[c.date]||(l[c.date]={calories:0,protein:0,carbs:0,fat:0}),l[c.date].calories+=c.calories||0,l[c.date].protein+=c.protein||0,l[c.date].carbs+=c.carbs||0,l[c.date].fat+=c.fat||0}),K().filter(c=>c.user_id===a.id&&c.date>=e&&c.date<=t).forEach(c=>{l[c.date]||(l[c.date]={calories:c.total_calories||c.totalCalories,protein:c.total_protein||c.totalProtein||0,carbs:c.total_carbs||c.totalCarbs||0,fat:c.total_fat||c.totalFat||0})}),Object.entries(l).map(([c,u])=>({date:c,totalCalories:u.calories,totalProtein:u.protein,totalCarbs:u.carbs,totalFat:u.fat})).sort((c,u)=>new Date(u.date).getTime()-new Date(c.date).getTime())}const{data:r,error:s}=await m.from("food_entries").select("date, calories, protein, carbs, fat").eq("user_id",a.id).gte("date",e).lte("date",t).order("date",{ascending:!1});if(s)return console.error("Supabase range summary fetch error:",s),[];const o={};(r||[]).forEach(n=>{o[n.date]||(o[n.date]={calories:0,protein:0,carbs:0,fat:0}),o[n.date].calories+=n.calories||0,o[n.date].protein+=n.protein||0,o[n.date].carbs+=n.carbs||0,o[n.date].fat+=n.fat||0});try{const{data:n}=await m.from("daily_summaries").select("date, total_calories, total_protein, total_carbs, total_fat").eq("user_id",a.id).gte("date",e).lte("date",t);(n||[]).forEach(l=>{o[l.date]||(o[l.date]={calories:l.total_calories,protein:l.total_protein,carbs:l.total_carbs,fat:l.total_fat})})}catch{}return Object.entries(o).map(([n,l])=>({date:n,totalCalories:l.calories,totalProtein:l.protein,totalCarbs:l.carbs,totalFat:l.fat})).sort((n,l)=>new Date(l.date).getTime()-new Date(n.date).getTime())},5*60*1e3),St=async e=>E(w.entriesForDate(e),async()=>{const t=await _();if(!t)return[];if(!f)return x().filter(s=>s.user_id===t.id&&s.date===e).map(s=>({...s,imageUrl:void 0,originalAiResponse:void 0})).sort((s,o)=>o.timestamp.localeCompare(s.timestamp));const{data:a,error:r}=await m.from("food_entries").select(ne).eq("user_id",t.id).eq("date",e).order("timestamp",{ascending:!1});return r?(console.error("Supabase date fetch error:",r),[]):a?a.map(F):[]},5*60*1e3),vt=async e=>E(w.entryImage(e),async()=>{const t=await _();if(!t)return null;if(!f){const o=x().find(n=>n.id===e&&n.user_id===t.id);return(o==null?void 0:o.imageUrl)||null}const{data:a,error:r}=await m.from("food_entries").select("image_url").eq("id",e).eq("user_id",t.id).single();return r||!a?null:a.image_url},30*60*1e3),Et=async()=>{const e=ae();return E(w.entriesForDate(`stats:${e}`),async()=>{var s,o;const t=await _();if(!t)return{count:0,calories:0,latestTimestamp:null};if(!f){const n=x().filter(d=>d.user_id===t.id&&d.date===e),l=n.sort((d,c)=>c.timestamp.localeCompare(d.timestamp));return{count:n.length,calories:n.reduce((d,c)=>d+c.calories,0),latestTimestamp:((s=l[0])==null?void 0:s.timestamp)||null}}const{data:a,error:r}=await m.from("food_entries").select("id, calories, timestamp").eq("user_id",t.id).eq("date",e).order("timestamp",{ascending:!1});return r||!a?{count:0,calories:0,latestTimestamp:null}:{count:a.length,calories:a.reduce((n,l)=>n+(l.calories||0),0),latestTimestamp:((o=a[0])==null?void 0:o.timestamp)||null}},2*60*1e3)},Ct=async e=>E(w.entriesForDate(`count:${e}`),async()=>{const t=await _();if(!t)return 0;if(!f)return x().filter(s=>s.user_id===t.id&&s.date===e).length;const{count:a,error:r}=await m.from("food_entries").select("id",{count:"exact",head:!0}).eq("user_id",t.id).eq("date",e);return r?(console.error("Error counting entries:",r),0):a||0},5*60*1e3),Z=async()=>{const e=await _();if(!e)return;const t=new Date;t.setDate(t.getDate()-30);const a=t.toISOString().split("T")[0];let r=[];if(!f)r=x().filter(o=>o.user_id===e.id&&o.date<a);else try{const{data:o}=await m.from("food_entries").select(Je).eq("user_id",e.id).lt("date",a);o&&(r=o.map(F))}catch{return}if(r.length===0)return;const s={};r.forEach(o=>{s[o.date]||(s[o.date]=[]),s[o.date].push(o)});for(const o of Object.keys(s)){const n=s[o],l={id:`${e.id}_${o}`,user_id:e.id,date:o,total_calories:n.reduce((d,c)=>d+c.calories,0),total_protein:n.reduce((d,c)=>d+(c.protein||0),0),total_carbs:n.reduce((d,c)=>d+(c.carbs||0),0),total_fat:n.reduce((d,c)=>d+(c.fat||0),0)};if(f)await m.from("daily_summaries").upsert(l),await m.from("food_entries").delete().eq("user_id",e.id).eq("date",o);else{const d=K(),c=d.findIndex(h=>h.user_id===e.id&&h.date===o);c>=0?d[c]=l:d.push(l),Ge(d);const u=x().filter(h=>!(h.user_id===e.id&&h.date===o));U(u)}}},Ot=async e=>{const t=await _();if(!t)throw new Error("Not logged in");if(!f){const r=x().filter(s=>!(s.id===e&&s.user_id===t.id));U(r),b.invalidatePattern(/^food:/);return}const{error:a}=await m.from("food_entries").delete().eq("id",e).eq("user_id",t.id);a&&j(a,"Delete Entry"),b.invalidatePattern(/^food:/)},kt=async e=>{const t=await _();if(!t)throw new Error("Not logged in");if(!f){const r=x(),s=r.findIndex(o=>o.id===e&&o.user_id===t.id);s>=0&&(r[s].imageUrl=void 0,U(r)),b.invalidatePattern(/^food:/);return}const{error:a}=await m.from("food_entries").update({image_url:null}).eq("id",e).eq("user_id",t.id);a&&j(a,"Clear Image"),b.invalidatePattern(/^food:/)},Nt=async()=>E(w.DAILY_GOAL,async()=>{const e=await _();if(!e)return 2e3;if(!f){const r=localStorage.getItem(L);return(r?JSON.parse(r):{})[e.id]||2e3}const{data:t,error:a}=await m.from("user_settings").select("daily_goal").eq("user_id",e.id).single();return a||!t?2e3:t.daily_goal},30*60*1e3),Ze=async e=>{const t=await _();if(!t)throw new Error("Not logged in");if(!f){const r=localStorage.getItem(L),s=r?JSON.parse(r):{};s[t.id]=e,localStorage.setItem(L,JSON.stringify(s)),b.invalidate(w.DAILY_GOAL);return}const{error:a}=await m.from("user_settings").upsert({user_id:t.id,daily_goal:e},{onConflict:"user_id"});a&&j(a,"Save Daily Goal"),b.invalidate(w.DAILY_GOAL)},Dt=async()=>E(w.USER_PROFILE,async()=>{const e=await _();if(!e)return null;if(!f){const r=localStorage.getItem(A);return(r?JSON.parse(r):{})[e.id]||null}const{data:t,error:a}=await m.from("user_profiles").select("name, height, weight, age, gender, activity_level, goal, equipment_access, target_weight").eq("user_id",e.id).single();return a||!t?null:{name:t.name,height:t.height,weight:t.weight,age:t.age,gender:t.gender,activityLevel:t.activity_level,goal:t.goal,equipmentAccess:t.equipment_access,targetWeight:t.target_weight}},30*60*1e3),Qe=async e=>{const t=await _();if(!t)throw new Error("Not logged in");if(!f){const r=localStorage.getItem(A),s=r?JSON.parse(r):{};s[t.id]=e,localStorage.setItem(A,JSON.stringify(s)),b.invalidate(w.USER_PROFILE);return}const{error:a}=await m.from("user_profiles").upsert({user_id:t.id,name:e.name,height:e.height,weight:e.weight,age:e.age,gender:e.gender,activity_level:e.activityLevel,goal:e.goal,equipment_access:e.equipmentAccess,target_weight:e.targetWeight},{onConflict:"user_id"});a&&j(a,"Save Profile"),b.invalidate(w.USER_PROFILE)},Lt=()=>x().length>0,At=async()=>{if(!f)throw new Error("Must be in Cloud Mode to sync");const e=await _();if(!e)throw new Error("Must be logged in to sync");const t=x();if(t.length>0){const s=t.map(n=>({id:n.id,user_id:e.id,timestamp:n.timestamp,date:n.date,time:n.time,food_item:n.food_item,calories:n.calories,protein:n.protein,carbs:n.carbs,fat:n.fat,confidence:n.confidence,is_manual:n.isManual,image_url:n.imageUrl,ingredients:n.ingredients,original_ai_response:n.originalAiResponse})),o=5;for(let n=0;n<s.length;n+=o){const l=s.slice(n,n+o),{error:d}=await m.from("food_entries").upsert(l);if(d)throw console.error("Chunk upload failed",d),new Error(`Sync failed at item ${n+1}: `+d.message)}}const a=localStorage.getItem(L);if(a){const s=JSON.parse(a),o=Object.keys(s)[0];o&&s[o]&&await Ze(s[o])}const r=localStorage.getItem(A);if(r){const s=JSON.parse(r),o=Object.keys(s)[0];o&&s[o]&&await Qe(s[o])}localStorage.removeItem(W),localStorage.removeItem(Y),localStorage.removeItem(L),localStorage.removeItem(A)},jt=async()=>{if(!f)return{ok:!0};if(!await _())return{ok:!0};const{error:t}=await m.from("food_entries").select("id").limit(1);return t?t.message.includes("relation")||t.code==="42P01"?{ok:!1,missingTables:!0,error:"Tables missing"}:{ok:!1,error:t.message}:{ok:!0}},T="snapcal_onboarding_v1",Xe=async e=>{if(!e||!e.id)return!1;const t=localStorage.getItem(T),a=t?JSON.parse(t):{};if(a[e.id]===!0)return!0;if(!f)return!1;try{const{data:r,error:s}=await m.from("user_settings").select("has_completed_onboarding").eq("user_id",e.id).maybeSingle(),o=(r==null?void 0:r.has_completed_onboarding)||!1;return o&&(a[e.id]=!0,localStorage.setItem(T,JSON.stringify(a))),o}catch{return!1}},Ve=async e=>{if(!e||!e.id)return;const t=localStorage.getItem(T),a=t?JSON.parse(t):{};if(a[e.id]=!0,localStorage.setItem(T,JSON.stringify(a)),f)try{const{error:r}=await m.from("user_settings").upsert({user_id:e.id,has_completed_onboarding:!0},{onConflict:"user_id"});r&&console.error("Cloud mark onboarding error:",r)}catch(r){console.error("Cloud mark onboarding exception:",r)}},It=async e=>{await Ve(e)},z=()=>{try{const e=localStorage.getItem(se);return e?JSON.parse(e):[]}catch{return[]}},ie=e=>{try{localStorage.setItem(se,JSON.stringify(e))}catch(t){console.error("Failed to save chat messages to local storage:",t)}},Rt=async e=>{const t=await _();if(!t){console.warn("User not logged in, cannot save chat message");return}const a=new Date(e.timestamp).toISOString().split("T")[0];if(!f){const r=z(),s={...e,user_id:t.id,date:a};r.push(s),ie(r);return}try{const{error:r}=await m.from("coach_messages").insert({id:e.id,user_id:t.id,role:e.role,content:e.content,timestamp:e.timestamp,date:a});r&&console.error("Failed to save chat message to Supabase:",r)}catch(r){console.error("Exception saving chat message:",r)}},et=async e=>{const t=await _();if(!t)return[];if(!f)return z().filter(r=>r.user_id===t.id&&r.date===e).sort((r,s)=>r.timestamp-s.timestamp);try{const{data:a,error:r}=await m.from("coach_messages").select("id, role, content, timestamp").eq("user_id",t.id).eq("date",e).order("timestamp",{ascending:!0});return r?(console.error("Failed to fetch chat messages:",r),[]):a||[]}catch(a){return console.error("Exception fetching chat messages:",a),[]}},Tt=async()=>{const e=new Date().toISOString().split("T")[0];return et(e)},Pt=async()=>{const e=await _();if(!e)return;const t=new Date;t.setDate(t.getDate()-30);const a=t.toISOString().split("T")[0];if(!f){const s=z().filter(o=>o.user_id!==e.id||o.date>=a);ie(s);return}try{const{error:r}=await m.from("coach_messages").delete().eq("user_id",e.id).lt("date",a);r&&console.error("Failed to cleanup old chat messages:",r)}catch(r){console.error("Exception during chat cleanup:",r)}},q=()=>{try{const e=localStorage.getItem(oe);return e?JSON.parse(e):[]}catch{return[]}},le=e=>{try{localStorage.setItem(oe,JSON.stringify(e))}catch(t){console.error("Failed to save workout plans to local storage:",t)}},tt=async(e,t,a,r,s)=>{const o=await _();if(!o)return console.warn("User not logged in, cannot save workout plan"),"";const n=r||`${o.id}_${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l={id:n,user_id:o.id,date:e,title:t,workout_type_id:s,exercises:a},d=q(),c=d.findIndex(u=>u.id===n);if(c>=0?d[c]=l:d.push(l),le(d),f)try{const{error:u}=await m.from("workout_plans").upsert({id:n,user_id:o.id,date:e,title:t,workout_type_id:s,exercises:a});u&&console.warn("Supabase save failed, using localStorage fallback:",u.message)}catch(u){console.warn("Exception saving workout plan to Supabase, using localStorage fallback:",u)}return n},Mt=async e=>{const t=await _();if(!t)return[];const a=[];if(q().filter(o=>o.user_id===t.id&&o.date===e).forEach(o=>{a.push({id:o.id,date:o.date,title:o.title,exercises:o.exercises})}),f)try{const{data:o,error:n}=await m.from("workout_plans").select("id, date, title, exercises").eq("user_id",t.id).eq("date",e);if(!n&&o){const l=new Set(a.map(d=>d.id));o.forEach(d=>{l.has(d.id)||a.push({id:d.id,date:d.date,title:d.title,exercises:d.exercises})})}}catch(o){console.warn("Exception fetching workout plans from Supabase, using localStorage only:",o)}return a},Ut=async(e,t)=>{const a=await _();if(!a)return[];const r=`${e}-${String(t).padStart(2,"0")}-01`,s=`${e}-${String(t).padStart(2,"0")}-31`,n=q().filter(l=>l.user_id===a.id&&l.date>=r&&l.date<=s).map(l=>l.date);if(f)try{const{data:l,error:d}=await m.from("workout_plans").select("date").eq("user_id",a.id).gte("date",r).lte("date",s);if(!d&&l){const c=l.map(u=>u.date);return Array.from(new Set([...n,...c]))}}catch(l){console.warn("Exception fetching workout plans from Supabase, using localStorage only:",l)}return n},Ft=async(e,t)=>{if(!await _()){console.warn("User not logged in, cannot save multi-day workout plan");return}const r=new Date(e);for(let s=0;s<t.length;s++){const o=t[s];if(o.isRestDay)continue;const n=new Date(r);n.setDate(n.getDate()+s);const l=n.toISOString().split("T")[0];await tt(l,o.title,o.exercises)}},qt=async e=>{const t=await _();if(!t){console.warn("User not logged in, cannot delete workout plan");return}const r=q().filter(s=>s.id!==e);if(le(r),f)try{const{error:s}=await m.from("workout_plans").delete().eq("id",e).eq("user_id",t.id);s&&console.warn("Failed to delete workout plan from Supabase:",s.message)}catch(s){console.warn("Exception deleting workout plan from Supabase:",s)}},rt=p.lazy(()=>k(()=>import("./Dashboard-DAO6s525.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url).then(e=>({default:e.Dashboard}))),at=p.lazy(()=>k(()=>import("./CalCoach-xMCRc9I7.js"),__vite__mapDeps([16,1,2,3,5,17,7,18,19,14,15]),import.meta.url).then(e=>({default:e.CalCoach}))),st=p.lazy(()=>k(()=>import("./WorkoutPlan-DngC3bIC.js"),__vite__mapDeps([20,1,2,3,17,6,7,14,11,13,21,22,10,23,15]),import.meta.url).then(e=>({default:e.WorkoutPlan}))),ot=p.lazy(()=>k(()=>import("./History-CeziRLgU.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,10,11,25,26,19,21,23,18,15]),import.meta.url).then(e=>({default:e.History}))),nt=p.lazy(()=>k(()=>import("./Profile-B2GM9Mco.js"),__vite__mapDeps([27,1,8,28,10,21,12,25,26,19,3,15]),import.meta.url).then(e=>({default:e.Profile}))),it=p.lazy(()=>k(()=>import("./Onboarding-BjH0VKg_.js"),__vite__mapDeps([29,1,7,9,25,22,21,28,19,6,23,3,15]),import.meta.url).then(e=>({default:e.Onboarding}))),Q=()=>i.jsx("div",{className:"min-h-screen bg-surface flex items-center justify-center",children:i.jsx("div",{className:"w-8 h-8 border-2 border-primary-200 border-t-primary-600 rounded-full animate-spin"})});function lt(){const[e,t]=p.useState(g.DASHBOARD),[a,r]=p.useState(null),[s,o]=p.useState(!0),[n,l]=p.useState(!1),[d,c]=p.useState(!0);p.useEffect(()=>{_().then(S=>{r(S),o(!1),S&&Z().catch(y=>console.error("Cleanup failed:",y))});const h=qe(S=>{r(S),o(!1),S&&Z().catch(y=>console.error("Cleanup failed:",y))});return()=>h()},[]),p.useEffect(()=>{Ke()&&(console.log("ðŸŒ… New day detected on app load! Clearing stale caches..."),b.clearDateSensitiveCaches(),window.dispatchEvent(new CustomEvent("midnight-refresh")));const h=Ye(()=>{console.log("ðŸŒ™ Midnight! Clearing caches and broadcasting refresh event..."),b.clearDateSensitiveCaches(),window.dispatchEvent(new CustomEvent("midnight-refresh"))});return()=>{h()}},[]),p.useEffect(()=>{(async()=>{if(a){c(!0);const S=await Xe(a);l(!S),c(!1)}else l(!1),c(!1)})()},[a]);const u=()=>{l(!1),t(g.DASHBOARD)};return s||d?i.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:i.jsx("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin"})}):a?n?i.jsx(p.Suspense,{fallback:i.jsx(Q,{}),children:i.jsx(it,{user:a,onComplete:u})}):i.jsx(Pe,{currentView:e,onNavigate:t,children:i.jsxs(p.Suspense,{fallback:i.jsx(Q,{}),children:[e===g.DASHBOARD&&i.jsx(rt,{}),e===g.CAL_COACH&&i.jsx(at,{onNavigate:t}),e===g.WORKOUT_PLAN&&i.jsx(st,{onNavigate:t}),e===g.HISTORY&&i.jsx(ot,{}),e===g.PROFILE&&i.jsx(nt,{})]})}):i.jsx(He,{})}class ct extends p.Component{constructor(a){super(a);N(this,"handleReload",()=>{this.setState({hasError:!1,error:null}),window.location.reload()});N(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){console.error("ErrorBoundary caught an error:",a,r)}render(){return this.state.hasError?i.jsx("div",{className:"min-h-screen bg-surface flex items-center justify-center p-6",children:i.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center",children:[i.jsx("div",{className:"w-16 h-16 mx-auto mb-6 bg-red-100 rounded-full flex items-center justify-center",children:i.jsx(Oe,{className:"w-8 h-8 text-red-500"})}),i.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"An unexpected error occurred. Please try again or reload the page."}),this.state.error&&i.jsxs("details",{className:"mb-6 text-left",children:[i.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700:text-gray-300",children:"Show error details"}),i.jsx("pre",{className:"mt-2 p-3 bg-gray-100 rounded-lg text-xs text-red-600 overflow-auto max-h-32",children:this.state.error.message})]}),i.jsxs("div",{className:"flex gap-3 justify-center",children:[i.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200:bg-gray-600 transition-colors",children:"Try Again"}),i.jsxs("button",{onClick:this.handleReload,className:"px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors flex items-center gap-2",children:[i.jsx(je,{className:"w-4 h-4"}),"Reload Page"]})]})]})}):this.props.children}}const ce=document.getElementById("root");if(!ce)throw new Error("Could not find root element to mount to");const dt=H.createRoot(ce);dt.render(i.jsx(fe.StrictMode,{children:i.jsx(ct,{children:i.jsx(lt,{})})}));export{Ce as A,Be as B,De as C,Le as D,wt as E,St as F,vt as G,bt as H,Ct as I,b as J,w as K,Et as L,kt as M,Lt as N,jt as O,Me as P,D as Q,je as R,Ie as S,At as T,Re as U,ht as V,pt as W,It as X,Ve as Y,Te as Z,Oe as a,yt as b,v as c,Nt as d,Dt as e,Ze as f,ae as g,Ot as h,xt as i,i as j,Mt as k,Ft as l,ke as m,Pt as n,Tt as o,g as p,tt as q,Rt as r,_t as s,et as t,Ut as u,qt as v,Qe as w,f as x,_ as y,m as z};
